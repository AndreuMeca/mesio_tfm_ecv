--stg ecv_hogar_basico
create table stgecv.ecv_raw_hogar_basico as
with taux_hogar as (
	select 
		"index"
		, '2011' as PK_CICLO
		, "DB010"
		, "DB020"
		, "DB030"
		, "DB040"
		, "DB040_F"
		, "DB060"
		, "DB060_F"
		, "DB075"
		, "DB075_F"
		, "DB090"
		, "DB090_F"
		, "DB100"
		, "DB100_F" 
	from stgecv.ecv_raw_hogar_2011_basico
	union all
	select 
		"index"
		, '2012' as PK_CICLO
		, "DB010"
		, "DB020"
		, "DB030"
		, "DB040"
		, "DB040_F"
		, "DB060"
		, "DB060_F"
		, "DB075"
		, "DB075_F"
		, "DB090"
		, "DB090_F"
		, "DB100"
		, "DB100_F" 
	from stgecv.ecv_raw_hogar_2012_basico
	union all
	select 
		"index"
		, '2013' as PK_CICLO
		, "DB010"
		, "DB020"
		, "DB030"
		, "DB040"
		, "DB040_F"
		, "DB060"
		, "DB060_F"
		, "DB075"
		, "DB075_F"
		, "DB090"
		, "DB090_F"
		, "DB100"
		, "DB100_F" 
	from stgecv.ecv_raw_hogar_2013_basico
	union all
	select 
		"index"
		, '2014' as PK_CICLO
		, "DB010"
		, "DB020"
		, "DB030"
		, "DB040"
		, "DB040_F"
		, "DB060"
		, "DB060_F"
		, "DB075"
		, "DB075_F"
		, null as "DB090"
		, null as "DB090_F"
		, "DB100"
		, "DB100_F" 
	from stgecv.ecv_raw_hogar_2014_basico
	union all
	select 
		"index"
		, '2015' as PK_CICLO
		, "DB010"
		, "DB020"
		, "DB030"
		, "DB040"
		, "DB040_F"
		, "DB060"
		, "DB060_F"
		, "DB075"
		, "DB075_F"
		, null as "DB090"
		, null as "DB090_F"
		, "DB100"
		, "DB100_F" 
	from stgecv.ecv_raw_hogar_2015_basico
	union all
	select 
		"index"
		, '2016' as PK_CICLO
		, "DB010"
		, "DB020"
		, "DB030"
		, "DB040"
		, "DB040_F"
		, "DB060"
		, "DB060_F"
		, "DB075"
		, "DB075_F"
		, null as "DB090"
		, null as "DB090_F"
		, "DB100"
		, "DB100_F" 
	from stgecv.ecv_raw_hogar_2016_basico
	union all
	select 
		"index"
		, '2017' as PK_CICLO
		, "DB010"
		, "DB020"
		, "DB030"
		, "DB040"
		, "DB040_F"
		, "DB060"
		, "DB060_F"
		, "DB075"
		, "DB075_F"
		, null as "DB090"
		, null as "DB090_F"
		, "DB100"
		, "DB100_F" 
	from stgecv.ecv_raw_hogar_2017_basico
	union all
	select 
		"index"
		, '2018' as PK_CICLO
		, "DB010"
		, "DB020"
		, "DB030"
		, "DB040"
		, "DB040_F"
		, "DB060"
		, "DB060_F"
		, "DB075"
		, "DB075_F"
		, null as "DB090"
		, null as "DB090_F"
		, "DB100"
		, "DB100_F" 
	from stgecv.ecv_raw_hogar_2018_basico
	union all
	select 
		"index"
		, '2019' as PK_CICLO
		, "DB010"
		, "DB020"
		, "DB030"
		, "DB040"
		, "DB040_F"
		, "DB060"
		, "DB060_F"
		, "DB075"
		, "DB075_F"
		, null as "DB090"
		, null as "DB090_F"
		, "DB100"
		, "DB100_F" 
	from stgecv.ecv_raw_hogar_2019_basico
	union all
	select 
		"index"
		, '2020' as PK_CICLO
		, "DB010"
		, "DB020"
		, "DB030"
		, "DB040"
		, "DB040_F"
		, "DB060"
		, "DB060_F"
		, "DB075"
		, "DB075_F"
		, null as "DB090"
		, null as "DB090_F"
		, "DB100"
		, "DB100_F" 
	from stgecv.ecv_raw_hogar_2020_basico
	union all
	select 
		"index"
		, '2021' as PK_CICLO
		, "DB010"
		, "DB020"
		, "DB030"
		, "DB040"
		, "DB040_F"
		, null as "DB060"
		, null as "DB060_F"
		, "DB075"
		, "DB075_F"
		, null as "DB090"
		, null as "DB090_F"
		, "DB100"
		, "DB100_F" 
	from stgecv.ecv_raw_hogar_2021_basico
	), 
	tdistinct as (
	select "DB010" || max("pk_ciclo") || "DB075" as pk_distinct
	from taux_hogar
	group by "DB010", "DB075"
	order by "DB010", "DB075"
	),
	tf1 as (
	select 
		"DB010"
		, "DB020"
		, pk_ciclo || "DB030" as "DB030"
		, "DB040"
		, "DB040_F"
		, "DB060"
		, "DB060_F"
		, "DB075"
		, "DB075_F"
		, "DB090"
		, "DB090_F"
		, "DB100"
		, "DB100_F" 
	from taux_hogar
	where "DB010" || "pk_ciclo" || "DB075" in (select * from tdistinct)
	),
	t_rotacion_distinct as (
		select distinct "DB010", "DB030"
		from tf1),
	t_rotacion as (
		select "DB010", "DB030",
			row_number() over(partition by "DB030" order by "DB010") as val_rotacion
		from t_rotacion_distinct)
	select 
		tf1."DB010"
		, "DB020"
		, tf1."DB030"
		, "DB040"
		, "DB040_F"
		, "DB060"
		, "DB060_F"
		, val_rotacion as "DB075"
		, "DB075_F"
		, "DB090"
		, "DB090_F"
		, "DB100"
		, "DB100_F" 
	from tf1
	left join t_rotacion
		on tf1."DB010" = t_rotacion."DB010"
			and tf1."DB030" = t_rotacion."DB030";

--stg: create table ecv_hogar
create table stgecv.ecv_raw_hogar as 
with
taux_hogar_detalle as (
	select
		"index"
		, '2011' as PK_CICLO
		, "HB010"
		, "HB020"
		, "HB030"
		, "HB050"
		, "HB050_F"
		, "HB060"
		, "HB060_F"
		, "HB070"
		, "HB070_F"
		, "HB080"
		, "HB080_F"
		, "HB090"
		, "HB090_F"
		, "HB100"
		, "HB100_F"
		, "HY020"
		, "HY020_F"
		, "HY022"
		, "HY022_F"
		, "HY023"
		, "HY023_F"
		, "HY030N"
		, "HY030N_F"
		, "HY040N"
		, "HY040N_F"
		, "HY050N"
		, "HY050N_F"
		, "HY060N"
		, "HY060N_F"
		, "HY070N"
		, "HY070N_F"
		, "HY080N"
		, "HY080N_F"
		, "HY090N"
		, "HY090N_F"
		, "HY100N"
		, "HY100N_F"
		, "HY110N"
		, "HY110N_F"
		, "HY120N"
		, "HY120N_F"
		, "HY130N"
		, "HY130N_F"
		, "HY145N"
		, "HY145N_F"
		, "HY170N"
		, "HY170N_F"
		, "HY010"
		, "HY010_F"
		, "HY040G"
		, "HY040G_F"
		, "HY050G"
		, "HY050G_F"
		, "HY060G"
		, "HY060G_F"
		, "HY070G"
		, "HY070G_F"
		, "HY080G"
		, "HY080G_F"
		, "HY090G"
		, "HY090G_F"
		, "HY100G"
		, "HY100G_F"
		, "HY110G"
		, "HY110G_F"
		, "HY120G"
		, "HY120G_F"
		, "HY130G"
		, "HY130G_F"
		, "HY140G"
		, "HY140G_F"
		, "HS011"
		, "HS011_F"
		, "HS021"
		, "HS021_F"
		, "HS031"
		, "HS031_F"
		, "HS040"
		, "HS040_F"
		, "HS050"
		, "HS050_F"
		, "HS060"
		, "HS060_F"
		, "HS070"
		, "HS070_F"
		, "HS080"
		, "HS080_F"
		, "HS090"
		, "HS090_F"
		, "HS100"
		, "HS100_F"
		, "HS110"
		, "HS110_F"
		, "HS120"
		, "HS120_F"
		, "HS130"
		, "HS130_F"
		, "HS140"
		, "HS140_F"
		, "HS150"
		, "HS150_F"
		, "HH010"
		, "HH010_F"
		, "HH020"
		, "HH020_F"
		, "HH021"
		, "HH021_F"
		, "HH030"
		, "HH030_F"
		, "HH031"
		, "HH031_F"
		, "HH040"
		, "HH040_F"
		, "HH050"
		, "HH050_F"
		, "HH060"
		, "HH060_F"
		, "HH061"
		, "HH061_F"
		, "HH070"
		, "HH070_F"
		, "HH081"
		, "HH081_F"
		, "HH091"
		, "HH091_F" 
	from stgecv.ecv_raw_hogar_2011_detalle
	union all
	select
		"index"
		, '2012' as PK_CICLO
		, "HB010"
		, "HB020"
		, "HB030"
		, "HB050"
		, "HB050_F"
		, "HB060"
		, "HB060_F"
		, "HB070"
		, "HB070_F"
		, "HB080"
		, "HB080_F"
		, "HB090"
		, "HB090_F"
		, "HB100"
		, "HB100_F"
		, "HY020"
		, "HY020_F"
		, "HY022"
		, "HY022_F"
		, "HY023"
		, "HY023_F"
		, "HY030N"
		, "HY030N_F"
		, "HY040N"
		, "HY040N_F"
		, "HY050N"
		, "HY050N_F"
		, "HY060N"
		, "HY060N_F"
		, "HY070N"
		, "HY070N_F"
		, "HY080N"
		, "HY080N_F"
		, "HY090N"
		, "HY090N_F"
		, "HY100N"
		, "HY100N_F"
		, "HY110N"
		, "HY110N_F"
		, "HY120N"
		, "HY120N_F"
		, "HY130N"
		, "HY130N_F"
		, "HY145N"
		, "HY145N_F"
		, "HY170N"
		, "HY170N_F"
		, "HY010"
		, "HY010_F"
		, "HY040G"
		, "HY040G_F"
		, "HY050G"
		, "HY050G_F"
		, "HY060G"
		, "HY060G_F"
		, "HY070G"
		, "HY070G_F"
		, "HY080G"
		, "HY080G_F"
		, "HY090G"
		, "HY090G_F"
		, "HY100G"
		, "HY100G_F"
		, "HY110G"
		, "HY110G_F"
		, "HY120G"
		, "HY120G_F"
		, "HY130G"
		, "HY130G_F"
		, "HY140G"
		, "HY140G_F"
		, "HS011"
		, "HS011_F"
		, "HS021"
		, "HS021_F"
		, "HS031"
		, "HS031_F"
		, "HS040"
		, "HS040_F"
		, "HS050"
		, "HS050_F"
		, "HS060"
		, "HS060_F"
		, "HS070"
		, "HS070_F"
		, "HS080"
		, "HS080_F"
		, "HS090"
		, "HS090_F"
		, "HS100"
		, "HS100_F"
		, "HS110"
		, "HS110_F"
		, "HS120"
		, "HS120_F"
		, "HS130"
		, "HS130_F"
		, "HS140"
		, "HS140_F"
		, "HS150"
		, "HS150_F"
		, "HH010"
		, "HH010_F"
		, "HH020"
		, "HH020_F"
		, "HH021"
		, "HH021_F"
		, "HH030"
		, "HH030_F"
		, "HH031"
		, "HH031_F"
		, "HH040"
		, "HH040_F"
		, "HH050"
		, "HH050_F"
		, "HH060"
		, "HH060_F"
		, "HH061"
		, "HH061_F"
		, "HH070"
		, "HH070_F"
		, "HH081"
		, "HH081_F"
		, "HH091"
		, "HH091_F" 
	from stgecv.ecv_raw_hogar_2012_detalle
	union all
	select
		"index"
		, '2013' as PK_CICLO
		, "HB010"
		, "HB020"
		, "HB030"
		, "HB050"
		, "HB050_F"
		, "HB060"
		, "HB060_F"
		, "HB070"
		, "HB070_F"
		, "HB080"
		, "HB080_F"
		, "HB090"
		, "HB090_F"
		, "HB100"
		, "HB100_F"
		, "HY020"
		, "HY020_F"
		, "HY022"
		, "HY022_F"
		, "HY023"
		, "HY023_F"
		, "HY030N"
		, "HY030N_F"
		, "HY040N"
		, "HY040N_F"
		, "HY050N"
		, "HY050N_F"
		, "HY060N"
		, "HY060N_F"
		, "HY070N"
		, "HY070N_F"
		, "HY080N"
		, "HY080N_F"
		, "HY090N"
		, "HY090N_F"
		, "HY100N"
		, "HY100N_F"
		, "HY110N"
		, "HY110N_F"
		, "HY120N"
		, "HY120N_F"
		, "HY130N"
		, "HY130N_F"
		, "HY145N"
		, "HY145N_F"
		, "HY170N"
		, "HY170N_F"
		, "HY010"
		, "HY010_F"
		, "HY040G"
		, "HY040G_F"
		, "HY050G"
		, "HY050G_F"
		, "HY060G"
		, "HY060G_F"
		, "HY070G"
		, "HY070G_F"
		, "HY080G"
		, "HY080G_F"
		, "HY090G"
		, "HY090G_F"
		, "HY100G"
		, "HY100G_F"
		, "HY110G"
		, "HY110G_F"
		, "HY120G"
		, "HY120G_F"
		, "HY130G"
		, "HY130G_F"
		, "HY140G"
		, "HY140G_F"
		, "HS011"
		, "HS011_F"
		, "HS021"
		, "HS021_F"
		, "HS031"
		, "HS031_F"
		, "HS040"
		, "HS040_F"
		, "HS050"
		, "HS050_F"
		, "HS060"
		, "HS060_F"
		, "HS070"
		, "HS070_F"
		, "HS080"
		, "HS080_F"
		, "HS090"
		, "HS090_F"
		, "HS100"
		, "HS100_F"
		, "HS110"
		, "HS110_F"
		, "HS120"
		, "HS120_F"
		, "HS130"
		, "HS130_F"
		, "HS140"
		, "HS140_F"
		, "HS150"
		, "HS150_F"
		, "HH010"
		, "HH010_F"
		, "HH020"
		, "HH020_F"
		, "HH021"
		, "HH021_F"
		, "HH030"
		, "HH030_F"
		, "HH031"
		, "HH031_F"
		, "HH040"
		, "HH040_F"
		, "HH050"
		, "HH050_F"
		, "HH060"
		, "HH060_F"
		, "HH061"
		, "HH061_F"
		, "HH070"
		, "HH070_F"
		, "HH081"
		, "HH081_F"
		, "HH091"
		, "HH091_F" 
	from stgecv.ecv_raw_hogar_2013_detalle
	union all
	select
		"index"
		, '2014' as PK_CICLO
		, "HB010"
		, "HB020"
		, "HB030"
		, "HB050"
		, "HB050_F"
		, "HB060"
		, "HB060_F"
		, "HB070"
		, "HB070_F"
		, "HB080"
		, "HB080_F"
		, "HB090"
		, "HB090_F"
		, "HB100"
		, "HB100_F"
		, "HY020"
		, "HY020_F"
		, "HY022"
		, "HY022_F"
		, "HY023"
		, "HY023_F"
		, "HY030N"
		, "HY030N_F"
		, "HY040N"
		, "HY040N_F"
		, "HY050N"
		, "HY050N_F"
		, "HY060N"
		, "HY060N_F"
		, "HY070N"
		, "HY070N_F"
		, "HY080N"
		, "HY080N_F"
		, "HY090N"
		, "HY090N_F"
		, "HY100N"
		, "HY100N_F"
		, "HY110N"
		, "HY110N_F"
		, "HY120N"
		, "HY120N_F"
		, "HY130N"
		, "HY130N_F"
		, "HY145N"
		, "HY145N_F"
		, "HY170N"
		, "HY170N_F"
		, "HY010"
		, "HY010_F"
		, "HY040G"
		, "HY040G_F"
		, "HY050G"
		, "HY050G_F"
		, "HY060G"
		, "HY060G_F"
		, "HY070G"
		, "HY070G_F"
		, "HY080G"
		, "HY080G_F"
		, "HY090G"
		, "HY090G_F"
		, "HY100G"
		, "HY100G_F"
		, "HY110G"
		, "HY110G_F"
		, "HY120G"
		, "HY120G_F"
		, "HY130G"
		, "HY130G_F"
		, "HY140G"
		, "HY140G_F"
		, "HS011"
		, "HS011_F"
		, "HS021"
		, "HS021_F"
		, "HS031"
		, "HS031_F"
		, "HS040"
		, "HS040_F"
		, "HS050"
		, "HS050_F"
		, "HS060"
		, "HS060_F"
		, "HS070"
		, "HS070_F"
		, "HS080"
		, "HS080_F"
		, "HS090"
		, "HS090_F"
		, "HS100"
		, "HS100_F"
		, "HS110"
		, "HS110_F"
		, "HS120"
		, "HS120_F"
		, "HS130"
		, "HS130_F"
		, "HS140"
		, "HS140_F"
		, "HS150"
		, "HS150_F"
		, "HH010"
		, "HH010_F"
		, "HH020"
		, "HH020_F"
		, "HH021"
		, "HH021_F"
		, "HH030"
		, "HH030_F"
		, "HH031"
		, "HH031_F"
		, "HH040"
		, "HH040_F"
		, "HH050"
		, "HH050_F"
		, "HH060"
		, "HH060_F"
		, "HH061"
		, "HH061_F"
		, "HH070"
		, "HH070_F"
		, "HH081"
		, "HH081_F"
		, "HH091"
		, "HH091_F" 
	from stgecv.ecv_raw_hogar_2014_detalle
	union all
	select
		"index"
		, '2015' as PK_CICLO
		, "HB010"
		, "HB020"
		, "HB030"
		, "HB050"
		, "HB050_F"
		, "HB060"
		, "HB060_F"
		, "HB070"
		, "HB070_F"
		, "HB080"
		, "HB080_F"
		, "HB090"
		, "HB090_F"
		, "HB100"
		, "HB100_F"
		, "HY020"
		, "HY020_F"
		, "HY022"
		, "HY022_F"
		, "HY023"
		, "HY023_F"
		, "HY030N"
		, "HY030N_F"
		, "HY040N"
		, "HY040N_F"
		, "HY050N"
		, "HY050N_F"
		, "HY060N"
		, "HY060N_F"
		, "HY070N"
		, "HY070N_F"
		, "HY080N"
		, "HY080N_F"
		, "HY090N"
		, "HY090N_F"
		, "HY100N"
		, "HY100N_F"
		, "HY110N"
		, "HY110N_F"
		, "HY120N"
		, "HY120N_F"
		, "HY130N"
		, "HY130N_F"
		, "HY145N"
		, "HY145N_F"
		, "HY170N"
		, "HY170N_F"
		, "HY010"
		, "HY010_F"
		, "HY040G"
		, "HY040G_F"
		, "HY050G"
		, "HY050G_F"
		, "HY060G"
		, "HY060G_F"
		, "HY070G"
		, "HY070G_F"
		, "HY080G"
		, "HY080G_F"
		, "HY090G"
		, "HY090G_F"
		, "HY100G"
		, "HY100G_F"
		, "HY110G"
		, "HY110G_F"
		, "HY120G"
		, "HY120G_F"
		, "HY130G"
		, "HY130G_F"
		, "HY140G"
		, "HY140G_F"
		, "HS011"
		, "HS011_F"
		, "HS021"
		, "HS021_F"
		, "HS031"
		, "HS031_F"
		, "HS040"
		, "HS040_F"
		, "HS050"
		, "HS050_F"
		, "HS060"
		, "HS060_F"
		, "HS070"
		, "HS070_F"
		, "HS080"
		, "HS080_F"
		, "HS090"
		, "HS090_F"
		, "HS100"
		, "HS100_F"
		, "HS110"
		, "HS110_F"
		, "HS120"
		, "HS120_F"
		, "HS130"
		, "HS130_F"
		, "HS140"
		, "HS140_F"
		, "HS150"
		, "HS150_F"
		, "HH010"
		, "HH010_F"
		, "HH020"
		, "HH020_F"
		, "HH021"
		, "HH021_F"
		, "HH030"
		, "HH030_F"
		, "HH031"
		, "HH031_F"
		, "HH040"
		, "HH040_F"
		, "HH050"
		, "HH050_F"
		, "HH060"
		, "HH060_F"
		, "HH061"
		, "HH061_F"
		, "HH070"
		, "HH070_F"
		, "HH081"
		, "HH081_F"
		, "HH091"
		, "HH091_F" 
	from stgecv.ecv_raw_hogar_2015_detalle
	union all
	select
		"index"
		, '2016' as PK_CICLO
		, "HB010"
		, "HB020"
		, "HB030"
		, "HB050"
		, "HB050_F"
		, "HB060"
		, "HB060_F"
		, "HB070"
		, "HB070_F"
		, "HB080"
		, "HB080_F"
		, "HB090"
		, "HB090_F"
		, "HB100"
		, "HB100_F"
		, "HY020"
		, "HY020_F"
		, "HY022"
		, "HY022_F"
		, "HY023"
		, "HY023_F"
		, "HY030N"
		, "HY030N_F"
		, "HY040N"
		, "HY040N_F"
		, "HY050N"
		, "HY050N_F"
		, "HY060N"
		, "HY060N_F"
		, "HY070N"
		, "HY070N_F"
		, "HY080N"
		, "HY080N_F"
		, "HY090N"
		, "HY090N_F"
		, "HY100N"
		, "HY100N_F"
		, "HY110N"
		, "HY110N_F"
		, "HY120N"
		, "HY120N_F"
		, "HY130N"
		, "HY130N_F"
		, "HY145N"
		, "HY145N_F"
		, "HY170N"
		, "HY170N_F"
		, "HY010"
		, "HY010_F"
		, "HY040G"
		, "HY040G_F"
		, "HY050G"
		, "HY050G_F"
		, "HY060G"
		, "HY060G_F"
		, "HY070G"
		, "HY070G_F"
		, "HY080G"
		, "HY080G_F"
		, "HY090G"
		, "HY090G_F"
		, "HY100G"
		, "HY100G_F"
		, "HY110G"
		, "HY110G_F"
		, "HY120G"
		, "HY120G_F"
		, "HY130G"
		, "HY130G_F"
		, "HY140G"
		, "HY140G_F"
		, "HS011"
		, "HS011_F"
		, "HS021"
		, "HS021_F"
		, "HS031"
		, "HS031_F"
		, "HS040"
		, "HS040_F"
		, "HS050"
		, "HS050_F"
		, "HS060"
		, "HS060_F"
		, "HS070"
		, "HS070_F"
		, "HS080"
		, "HS080_F"
		, "HS090"
		, "HS090_F"
		, "HS100"
		, "HS100_F"
		, "HS110"
		, "HS110_F"
		, "HS120"
		, "HS120_F"
		, "HS130"
		, "HS130_F"
		, "HS140"
		, "HS140_F"
		, "HS150"
		, "HS150_F"
		, "HH010"
		, "HH010_F"
		, "HH020"
		, "HH020_F"
		, "HH021"
		, "HH021_F"
		, "HH030"
		, "HH030_F"
		, "HH031"
		, "HH031_F"
		, "HH040"
		, "HH040_F"
		, "HH050"
		, "HH050_F"
		, "HH060"
		, "HH060_F"
		, "HH061"
		, "HH061_F"
		, "HH070"
		, "HH070_F"
		, "HH081"
		, "HH081_F"
		, "HH091"
		, "HH091_F" 
	from stgecv.ecv_raw_hogar_2016_detalle
	union all
	select
		"index"
		, '2017' as PK_CICLO
		, "HB010"
		, "HB020"
		, "HB030"
		, "HB050"
		, "HB050_F"
		, "HB060"
		, "HB060_F"
		, "HB070"
		, "HB070_F"
		, "HB080"
		, "HB080_F"
		, "HB090"
		, "HB090_F"
		, "HB100"
		, "HB100_F"
		, "HY020"
		, "HY020_F"
		, "HY022"
		, "HY022_F"
		, "HY023"
		, "HY023_F"
		, "HY030N"
		, "HY030N_F"
		, "HY040N"
		, "HY040N_F"
		, "HY050N"
		, "HY050N_F"
		, "HY060N"
		, "HY060N_F"
		, "HY070N"
		, "HY070N_F"
		, "HY080N"
		, "HY080N_F"
		, "HY090N"
		, "HY090N_F"
		, "HY100N"
		, "HY100N_F"
		, "HY110N"
		, "HY110N_F"
		, "HY120N"
		, "HY120N_F"
		, "HY130N"
		, "HY130N_F"
		, "HY145N"
		, "HY145N_F"
		, "HY170N"
		, "HY170N_F"
		, "HY010"
		, "HY010_F"
		, "HY040G"
		, "HY040G_F"
		, "HY050G"
		, "HY050G_F"
		, "HY060G"
		, "HY060G_F"
		, "HY070G"
		, "HY070G_F"
		, "HY080G"
		, "HY080G_F"
		, "HY090G"
		, "HY090G_F"
		, "HY100G"
		, "HY100G_F"
		, "HY110G"
		, "HY110G_F"
		, "HY120G"
		, "HY120G_F"
		, "HY130G"
		, "HY130G_F"
		, "HY140G"
		, "HY140G_F"
		, "HS011"
		, "HS011_F"
		, "HS021"
		, "HS021_F"
		, "HS031"
		, "HS031_F"
		, "HS040"
		, "HS040_F"
		, "HS050"
		, "HS050_F"
		, "HS060"
		, "HS060_F"
		, "HS070"
		, "HS070_F"
		, "HS080"
		, "HS080_F"
		, "HS090"
		, "HS090_F"
		, "HS100"
		, "HS100_F"
		, "HS110"
		, "HS110_F"
		, "HS120"
		, "HS120_F"
		, "HS130"
		, "HS130_F"
		, "HS140"
		, "HS140_F"
		, "HS150"
		, "HS150_F"
		, "HH010"
		, "HH010_F"
		, "HH020"
		, "HH020_F"
		, "HH021"
		, "HH021_F"
		, "HH030"
		, "HH030_F"
		, "HH031"
		, "HH031_F"
		, "HH040"
		, "HH040_F"
		, "HH050"
		, "HH050_F"
		, "HH060"
		, "HH060_F"
		, "HH061"
		, "HH061_F"
		, "HH070"
		, "HH070_F"
		, "HH081"
		, "HH081_F"
		, "HH091"
		, "HH091_F" 
	from stgecv.ecv_raw_hogar_2017_detalle
	union all
	select
		"index"
		, '2018' as PK_CICLO
		, "HB010"
		, "HB020"
		, "HB030"
		, "HB050"
		, "HB050_F"
		, "HB060"
		, "HB060_F"
		, "HB070"
		, "HB070_F"
		, "HB080"
		, "HB080_F"
		, "HB090"
		, "HB090_F"
		, "HB100"
		, "HB100_F"
		, "HY020"
		, "HY020_F"
		, "HY022"
		, "HY022_F"
		, "HY023"
		, "HY023_F"
		, "HY030N"
		, "HY030N_F"
		, "HY040N"
		, "HY040N_F"
		, "HY050N"
		, "HY050N_F"
		, "HY060N"
		, "HY060N_F"
		, "HY070N"
		, "HY070N_F"
		, "HY080N"
		, "HY080N_F"
		, "HY090N"
		, "HY090N_F"
		, "HY100N"
		, "HY100N_F"
		, "HY110N"
		, "HY110N_F"
		, "HY120N"
		, "HY120N_F"
		, "HY130N"
		, "HY130N_F"
		, "HY145N"
		, "HY145N_F"
		, "HY170N"
		, "HY170N_F"
		, "HY010"
		, "HY010_F"
		, "HY040G"
		, "HY040G_F"
		, "HY050G"
		, "HY050G_F"
		, "HY060G"
		, "HY060G_F"
		, "HY070G"
		, "HY070G_F"
		, "HY080G"
		, "HY080G_F"
		, "HY090G"
		, "HY090G_F"
		, "HY100G"
		, "HY100G_F"
		, "HY110G"
		, "HY110G_F"
		, "HY120G"
		, "HY120G_F"
		, "HY130G"
		, "HY130G_F"
		, "HY140G"
		, "HY140G_F"
		, "HS011"
		, "HS011_F"
		, "HS021"
		, "HS021_F"
		, "HS031"
		, "HS031_F"
		, "HS040"
		, "HS040_F"
		, "HS050"
		, "HS050_F"
		, "HS060"
		, "HS060_F"
		, "HS070"
		, "HS070_F"
		, "HS080"
		, "HS080_F"
		, "HS090"
		, "HS090_F"
		, "HS100"
		, "HS100_F"
		, "HS110"
		, "HS110_F"
		, "HS120"
		, "HS120_F"
		, "HS130"
		, "HS130_F"
		, "HS140"
		, "HS140_F"
		, "HS150"
		, "HS150_F"
		, "HH010"
		, "HH010_F"
		, "HH020"
		, "HH020_F"
		, "HH021"
		, "HH021_F"
		, "HH030"
		, "HH030_F"
		, "HH031"
		, "HH031_F"
		, "HH040"
		, "HH040_F"
		, "HH050"
		, "HH050_F"
		, "HH060"
		, "HH060_F"
		, "HH061"
		, "HH061_F"
		, "HH070"
		, "HH070_F"
		, "HH081"
		, "HH081_F"
		, "HH091"
		, "HH091_F" 
	from stgecv.ecv_raw_hogar_2018_detalle
	union all
	select
		"index"
		, '2019' as PK_CICLO
		, "HB010"
		, "HB020"
		, "HB030"
		, "HB050"
		, "HB050_F"
		, "HB060"
		, "HB060_F"
		, "HB070"
		, "HB070_F"
		, "HB080"
		, "HB080_F"
		, "HB090"
		, "HB090_F"
		, "HB100"
		, "HB100_F"
		, "HY020"
		, "HY020_F"
		, "HY022"
		, "HY022_F"
		, "HY023"
		, "HY023_F"
		, "HY030N"
		, "HY030N_F"
		, "HY040N"
		, "HY040N_F"
		, "HY050N"
		, "HY050N_F"
		, "HY060N"
		, "HY060N_F"
		, "HY070N"
		, "HY070N_F"
		, "HY080N"
		, "HY080N_F"
		, "HY090N"
		, "HY090N_F"
		, "HY100N"
		, "HY100N_F"
		, "HY110N"
		, "HY110N_F"
		, "HY120N"
		, "HY120N_F"
		, "HY130N"
		, "HY130N_F"
		, "HY145N"
		, "HY145N_F"
		, "HY170N"
		, "HY170N_F"
		, "HY010"
		, "HY010_F"
		, "HY040G"
		, "HY040G_F"
		, "HY050G"
		, "HY050G_F"
		, "HY060G"
		, "HY060G_F"
		, "HY070G"
		, "HY070G_F"
		, "HY080G"
		, "HY080G_F"
		, "HY090G"
		, "HY090G_F"
		, "HY100G"
		, "HY100G_F"
		, "HY110G"
		, "HY110G_F"
		, "HY120G"
		, "HY120G_F"
		, "HY130G"
		, "HY130G_F"
		, "HY140G"
		, "HY140G_F"
		, "HS011"
		, "HS011_F"
		, "HS021"
		, "HS021_F"
		, "HS031"
		, "HS031_F"
		, "HS040"
		, "HS040_F"
		, "HS050"
		, "HS050_F"
		, "HS060"
		, "HS060_F"
		, "HS070"
		, "HS070_F"
		, "HS080"
		, "HS080_F"
		, "HS090"
		, "HS090_F"
		, "HS100"
		, "HS100_F"
		, "HS110"
		, "HS110_F"
		, "HS120"
		, "HS120_F"
		, "HS130"
		, "HS130_F"
		, "HS140"
		, "HS140_F"
		, "HS150"
		, "HS150_F"
		, "HH010"
		, "HH010_F"
		, "HH020"
		, "HH020_F"
		, "HH021"
		, "HH021_F"
		, "HH030"
		, "HH030_F"
		, "HH031"
		, "HH031_F"
		, "HH040"
		, "HH040_F"
		, "HH050"
		, "HH050_F"
		, "HH060"
		, "HH060_F"
		, "HH061"
		, "HH061_F"
		, "HH070"
		, "HH070_F"
		, "HH081"
		, "HH081_F"
		, "HH091"
		, "HH091_F" 
	from stgecv.ecv_raw_hogar_2019_detalle
	union all
	select
		"index"
		, '2020' as PK_CICLO
		, "HB010"
		, "HB020"
		, "HB030"
		, "HB050"
		, "HB050_F"
		, "HB060"
		, "HB060_F"
		, "HB070"
		, "HB070_F"
		, "HB080"
		, "HB080_F"
		, "HB090"
		, "HB090_F"
		, "HB100"
		, "HB100_F"
		, "HY020"
		, "HY020_F"
		, "HY022"
		, "HY022_F"
		, "HY023"
		, "HY023_F"
		, "HY030N"
		, "HY030N_F"
		, "HY040N"
		, "HY040N_F"
		, "HY050N"
		, "HY050N_F"
		, "HY060N"
		, "HY060N_F"
		, "HY070N"
		, "HY070N_F"
		, "HY080N"
		, "HY080N_F"
		, "HY090N"
		, "HY090N_F"
		, "HY100N"
		, "HY100N_F"
		, "HY110N"
		, "HY110N_F"
		, "HY120N"
		, "HY120N_F"
		, "HY130N"
		, "HY130N_F"
		, "HY145N"
		, "HY145N_F"
		, "HY170N"
		, "HY170N_F"
		, "HY010"
		, "HY010_F"
		, "HY040G"
		, "HY040G_F"
		, "HY050G"
		, "HY050G_F"
		, "HY060G"
		, "HY060G_F"
		, "HY070G"
		, "HY070G_F"
		, "HY080G"
		, "HY080G_F"
		, "HY090G"
		, "HY090G_F"
		, "HY100G"
		, "HY100G_F"
		, "HY110G"
		, "HY110G_F"
		, "HY120G"
		, "HY120G_F"
		, "HY130G"
		, "HY130G_F"
		, "HY140G"
		, "HY140G_F"
		, "HS011"
		, "HS011_F"
		, "HS021"
		, "HS021_F"
		, "HS031"
		, "HS031_F"
		, "HS040"
		, "HS040_F"
		, "HS050"
		, "HS050_F"
		, "HS060"
		, "HS060_F"
		, "HS070"
		, "HS070_F"
		, "HS080"
		, "HS080_F"
		, "HS090"
		, "HS090_F"
		, "HS100"
		, "HS100_F"
		, "HS110"
		, "HS110_F"
		, "HS120"
		, "HS120_F"
		, "HS130"
		, "HS130_F"
		, "HS140"
		, "HS140_F"
		, "HS150"
		, "HS150_F"
		, "HH010"
		, "HH010_F"
		, "HH020"
		, "HH020_F"
		, "HH021"
		, "HH021_F"
		, "HH030"
		, "HH030_F"
		, "HH031"
		, "HH031_F"
		, "HH040"
		, "HH040_F"
		, "HH050"
		, "HH050_F"
		, "HH060"
		, "HH060_F"
		, "HH061"
		, "HH061_F"
		, "HH070"
		, "HH070_F"
		, "HH081"
		, "HH081_F"
		, "HH091"
		, "HH091_F" 
	from stgecv.ecv_raw_hogar_2020_detalle
	union all
	select
		"index"
		, '2021' as PK_CICLO
		, "HB010"
		, "HB020"
		, "HB030"
		, "HB050"
		, "HB050_F"
		, "HB060"
		, "HB060_F"
		, "HB070"
		, "HB070_F"
		, "HB080"
		, "HB080_F"
		, null as "HB090"
		, null as "HB090_F"
		, "HB100"
		, "HB100_F"
		, "HY020"
		, null as "HY020_F"
		, "HY022"
		, null as "HY022_F"
		, "HY023"
		, null as "HY023_F"
		, "HY030N"
		, null as "HY030N_F"
		, "HY040N"
		, null as "HY040N_F"
		, "HY050N"
		, null as "HY050N_F"
		, "HY060N"
		, null as "HY060N_F"
		, "HY070N"
		, null as "HY070N_F"
		, "HY080N"
		, null as "HY080N_F"
		, "HY090N"
		, null as "HY090N_F"
		, "HY100N"
		, null as "HY100N_F"
		, "HY110N"
		, null as "HY110N_F"
		, "HY120N"
		, null as "HY120N_F"
		, "HY130N"
		, null as "HY130N_F"
		, "HY145N"
		, null as "HY145N_F"
		, "HY170N"
		, null as "HY170N_F"
		, "HY010"
		, null as "HY010_F"
		, "HY040G"
		, null as "HY040G_F"
		, "HY050G"
		, null as "HY050G_F"
		, "HY060G"
		, null as "HY060G_F"
		, "HY070G"
		, null as "HY070G_F"
		, "HY080G"
		, null as "HY080G_F"
		, "HY090G"
		, null as "HY090G_F"
		, "HY100G"
		, null as "HY100G_F"
		, "HY110G"
		, null as "HY110G_F"
		, "HY120G"
		, null as "HY120G_F"
		, "HY130G"
		, null as "HY130G_F"
		, "HY140G"
		, null as "HY140G_F"
		, "HS011"
		, "HS011_F"
		, "HS021"
		, "HS021_F"
		, "HS031"
		, "HS031_F"
		, "HS040"
		, "HS040_F"
		, "HS050"
		, "HS050_F"
		, "HS060"
		, "HS060_F"
		, null as "HS070"
		, null as "HS070_F"
		, null as "HS080"
		, null as "HS080_F"
		, "HS090"
		, "HS090_F"
		, null as "HS100"
		, null as "HS100_F"
		, "HS110"
		, "HS110_F"
		, "HS120"
		, "HS120_F"
		, null as "HS130"
		, null as "HS130_F"
		, null as "HS140"
		, null as "HS140_F"
		, "HS150"
		, "HS150_F"
		, "HH010"
		, "HH010_F"
		, null as "HH020"
		, null as "HH020_F"
		, "HH021"
		, "HH021_F"
		, "HH030"
		, "HH030_F"
		, null as "HH031"
		, null as "HH031_F"
		, null as "HH040"
		, null as "HH040_F"
		, "HH050"
		, "HH050_F"
		, "HH060"
		, "HH060_F"
		, null as "HH061"
		, null as "HH061_F"
		, "HH070"
		, "HH070_F"
		, null as "HH081"
		, null as "HH081_F"
		, null as "HH091"
		, null as "HH091_F" 
	from stgecv.ecv_raw_hogar_2021_detalle
),
taux_hogar as
(
	select 
		concat("DB010", "DB030") as pk_distinct 
	from stgecv.ecv_raw_hogar_basico
)
select "HB010"
		, "HB020"
		, "pk_ciclo" || "HB030" as "HB030"
		, "HB050"
		, "HB050_F"
		, "HB060"
		, "HB060_F"
		, "HB070"
		, "HB070_F"
		, "HB080"
		, "HB080_F"
		, "HB090"
		, "HB090_F"
		, "HB100"
		, "HB100_F"
		, "HY020"
		, "HY020_F"
		, "HY022"
		, "HY022_F"
		, "HY023"
		, "HY023_F"
		, "HY030N"
		, "HY030N_F"
		, "HY040N"
		, "HY040N_F"
		, "HY050N"
		, "HY050N_F"
		, "HY060N"
		, "HY060N_F"
		, "HY070N"
		, "HY070N_F"
		, "HY080N"
		, "HY080N_F"
		, "HY090N"
		, "HY090N_F"
		, "HY100N"
		, "HY100N_F"
		, "HY110N"
		, "HY110N_F"
		, "HY120N"
		, "HY120N_F"
		, "HY130N"
		, "HY130N_F"
		, "HY145N"
		, "HY145N_F"
		, "HY170N"
		, "HY170N_F"
		, "HY010"
		, "HY010_F"
		, "HY040G"
		, "HY040G_F"
		, "HY050G"
		, "HY050G_F"
		, "HY060G"
		, "HY060G_F"
		, "HY070G"
		, "HY070G_F"
		, "HY080G"
		, "HY080G_F"
		, "HY090G"
		, "HY090G_F"
		, "HY100G"
		, "HY100G_F"
		, "HY110G"
		, "HY110G_F"
		, "HY120G"
		, "HY120G_F"
		, "HY130G"
		, "HY130G_F"
		, "HY140G"
		, "HY140G_F"
		, "HS011"
		, "HS011_F"
		, "HS021"
		, "HS021_F"
		, "HS031"
		, "HS031_F"
		, "HS040"
		, "HS040_F"
		, "HS050"
		, "HS050_F"
		, "HS060"
		, "HS060_F"
		, "HS070"
		, "HS070_F"
		, "HS080"
		, "HS080_F"
		, "HS090"
		, "HS090_F"
		, "HS100"
		, "HS100_F"
		, "HS110"
		, "HS110_F"
		, "HS120"
		, "HS120_F"
		, "HS130"
		, "HS130_F"
		, "HS140"
		, "HS140_F"
		, "HS150"
		, "HS150_F"
		, "HH010"
		, "HH010_F"
		, "HH020"
		, "HH020_F"
		, "HH021"
		, "HH021_F"
		, "HH030"
		, "HH030_F"
		, "HH031"
		, "HH031_F"
		, "HH040"
		, "HH040_F"
		, "HH050"
		, "HH050_F"
		, "HH060"
		, "HH060_F"
		, "HH061"
		, "HH061_F"
		, "HH070"
		, "HH070_F"
		, "HH081"
		, "HH081_F"
		, "HH091"
		, "HH091_F" 
from taux_hogar_detalle
where "HB010" || "pk_ciclo" || "HB030" in (select * from taux_hogar)
;

--stg: create persona b√°sico
create table stgecv.ecv_raw_persona_basico as
with 
t1_2011 as (
select 
	max("index")  as "idx_keep", 
	"RB030", "RB010"
from stgecv.ecv_raw_persona_2011_basico
group by "RB010", "RB030"
),
t2_2011 as (
select "RB030"
from stgecv.ecv_raw_persona_2011_basico
where "index" in (select "idx_keep" from t1_2011)
group by "RB030"
),
t1_2012 as (
select 
	max("index")  as "idx_keep", 
	"RB030", "RB010"
from stgecv.ecv_raw_persona_2012_basico
group by "RB010", "RB030"
),
t2_2012 as (
select "RB030"
from stgecv.ecv_raw_persona_2012_basico
where "index" in (select "idx_keep" from t1_2012)
group by "RB030"
),
t1_2013 as (
select 
	max("index")  as "idx_keep", 
	"RB030", "RB010"
from stgecv.ecv_raw_persona_2013_basico
group by "RB010", "RB030"
),
t2_2013 as (
select "RB030"
from stgecv.ecv_raw_persona_2013_basico
where "index" in (select "idx_keep" from t1_2013)
group by "RB030"
),
t1_2014 as (
select 
	max("index")  as "idx_keep", 
	"RB030", "RB010"
from stgecv.ecv_raw_persona_2014_basico
group by "RB010", "RB030"
),
t2_2014 as (
select "RB030"
from stgecv.ecv_raw_persona_2014_basico
where "index" in (select "idx_keep" from t1_2014)
group by "RB030"
),
t1_2015 as (
select 
	max("index")  as "idx_keep", 
	"RB030", "RB010"
from stgecv.ecv_raw_persona_2015_basico
group by "RB010", "RB030"
),
t2_2015 as (
select "RB030"
from stgecv.ecv_raw_persona_2015_basico
where "index" in (select "idx_keep" from t1_2015)
group by "RB030"
),
t1_2016 as (
select 
	max("index")  as "idx_keep", 
	"RB030", "RB010"
from stgecv.ecv_raw_persona_2016_basico
group by "RB010", "RB030"
),
t2_2016 as (
select "RB030"
from stgecv.ecv_raw_persona_2016_basico
where "index" in (select "idx_keep" from t1_2016)
group by "RB030"
),
t1_2017 as (
select 
	max("index")  as "idx_keep", 
	"RB030", "RB010"
from stgecv.ecv_raw_persona_2017_basico
group by "RB010", "RB030"
),
t2_2017 as (
select "RB030"
from stgecv.ecv_raw_persona_2017_basico
where "index" in (select "idx_keep" from t1_2017)
group by "RB030"
),
t1_2018 as (
select 
	max("index")  as "idx_keep", 
	"RB030", "RB010"
from stgecv.ecv_raw_persona_2018_basico
group by "RB010", "RB030"
),
t2_2018 as (
select "RB030"
from stgecv.ecv_raw_persona_2018_basico
where "index" in (select "idx_keep" from t1_2018)
group by "RB030"
),
t1_2019 as (
select 
	max("index")  as "idx_keep", 
	"RB030", "RB010"
from stgecv.ecv_raw_persona_2019_basico
group by "RB010", "RB030"
),
t2_2019 as (
select "RB030"
from stgecv.ecv_raw_persona_2019_basico
where "index" in (select "idx_keep" from t1_2019)
group by "RB030"
),
t1_2020 as (
select 
	max("index")  as "idx_keep", 
	"RB030", "RB010"
from stgecv.ecv_raw_persona_2020_basico
group by "RB010", "RB030"
),
t2_2020 as (
select "RB030"
from stgecv.ecv_raw_persona_2020_basico
where "index" in (select "idx_keep" from t1_2020)
group by "RB030"
),
t1_2021 as (
select 
	max("index")  as "idx_keep", 
	"RB030", "RB010"
from stgecv.ecv_raw_persona_2021_basico
group by "RB010", "RB030"
),
t2_2021 as (
select "RB030"
from stgecv.ecv_raw_persona_2021_basico
where "index" in (select "idx_keep" from t1_2021)
group by "RB030"
),
taux_persona as (
(select 
	"index"
	, '2011' as PK_CICLO
	, "RB010"
	, "RB020"
	, "RB030"
	, "RB040"
	, "RB060"
	, "RB060_F"
	, "RB062"
	, "RB062_F"
	, "RB063"
	, "RB063_F"
	, "RB064"
	, "RB064_F"
	, "RB100"
	, "RB100_F"
	, "RB070"
	, "RB070_F"
	, "RB080"
	, "RB080_F"
	, "RB090"
	, "RB090_F"
	, "RB110"
	, "RB110_F"
	, "RB120"
	, "RB120_F"
	, "RB140"
	, "RB140_F"
	, "RB150"
	, "RB150_F"
	, "RB160"
	, "RB160_F"
	, "RB170"
	, "RB170_F"
	, "RB180"
	, "RB180_F"
	, "RB190"
	, "RB190_F"
	, "RB200"
	, "RB200_F"
	, "RB210"
	, "RB210_F"
	, "RB220"
	, "RB220_F"
	, "RB230"
	, "RB230_F"
	, "RB240"
	, "RB240_F" 
from stgecv.ecv_raw_persona_2011_basico
where "index" in (select "idx_keep" from t1_2011)
)
union all
(
select 
	"index"
	, '2012' as PK_CICLO
	, "RB010"
	, "RB020"
	, "RB030"
	, "RB040"
	, "RB060"
	, "RB060_F"
	, "RB062"
	, "RB062_F"
	, "RB063"
	, "RB063_F"
	, "RB064"
	, "RB064_F"
	, "RB100"
	, "RB100_F"
	, "RB070"
	, "RB070_F"
	, "RB080"
	, "RB080_F"
	, "RB090"
	, "RB090_F"
	, "RB110"
	, "RB110_F"
	, "RB120"
	, "RB120_F"
	, "RB140"
	, "RB140_F"
	, "RB150"
	, "RB150_F"
	, "RB160"
	, "RB160_F"
	, "RB170"
	, "RB170_F"
	, "RB180"
	, "RB180_F"
	, "RB190"
	, "RB190_F"
	, "RB200"
	, "RB200_F"
	, "RB210"
	, "RB210_F"
	, "RB220"
	, "RB220_F"
	, "RB230"
	, "RB230_F"
	, "RB240"
	, "RB240_F" 
from stgecv.ecv_raw_persona_2012_basico
where "index" in (select "idx_keep" from t1_2012)
)
union all
(
select 
	"index"
	, '2013' as PK_CICLO
	, "RB010"
	, "RB020"
	, "RB030"
	, "RB040"
	, "RB060"
	, "RB060_F"
	, "RB062"
	, "RB062_F"
	, "RB063"
	, "RB063_F"
	, "RB064"
	, "RB064_F"
	, "RB100"
	, "RB100_F"
	, "RB070"
	, "RB070_F"
	, "RB080"
	, "RB080_F"
	, "RB090"
	, "RB090_F"
	, "RB110"
	, "RB110_F"
	, "RB120"
	, "RB120_F"
	, "RB140"
	, "RB140_F"
	, "RB150"
	, "RB150_F"
	, "RB160"
	, "RB160_F"
	, "RB170"
	, "RB170_F"
	, "RB180"
	, "RB180_F"
	, "RB190"
	, "RB190_F"
	, "RB200"
	, "RB200_F"
	, "RB210"
	, "RB210_F"
	, "RB220"
	, "RB220_F"
	, "RB230"
	, "RB230_F"
	, "RB240"
	, "RB240_F" 
from stgecv.ecv_raw_persona_2013_basico
where "index" in (select "idx_keep" from t1_2013)
)
union all
(
select 
	"index"
	, '2014' as PK_CICLO
	, "RB010"
	, "RB020"
	, "RB030"
	, "RB040"
	, "RB060"
	, "RB060_F"
	, "RB062"
	, "RB062_F"
	, "RB063"
	, "RB063_F"
	, "RB064"
	, "RB064_F"
	, "RB100"
	, "RB100_F"
	, "RB070"
	, "RB070_F"
	, "RB080"
	, "RB080_F"
	, "RB090"
	, "RB090_F"
	, "RB110"
	, "RB110_F"
	, "RB120"
	, "RB120_F"
	, "RB140"
	, "RB140_F"
	, "RB150"
	, "RB150_F"
	, "RB160"
	, "RB160_F"
	, "RB170"
	, "RB170_F"
	, "RB180"
	, "RB180_F"
	, "RB190"
	, "RB190_F"
	, "RB200"
	, "RB200_F"
	, "RB210"
	, "RB210_F"
	, "RB220"
	, "RB220_F"
	, "RB230"
	, "RB230_F"
	, "RB240"
	, "RB240_F" 
from stgecv.ecv_raw_persona_2014_basico
where "index" in (select "idx_keep" from t1_2014)
)
union all
(
select 
	"index"
	, '2015' as PK_CICLO
	, "RB010"
	, "RB020"
	, "RB030"
	, "RB040"
	, "RB060"
	, "RB060_F"
	, "RB062"
	, "RB062_F"
	, "RB063"
	, "RB063_F"
	, "RB064"
	, "RB064_F"
	, "RB100"
	, "RB100_F"
	, "RB070"
	, "RB070_F"
	, "RB080"
	, "RB080_F"
	, "RB090"
	, "RB090_F"
	, "RB110"
	, "RB110_F"
	, "RB120"
	, "RB120_F"
	, "RB140"
	, "RB140_F"
	, "RB150"
	, "RB150_F"
	, "RB160"
	, "RB160_F"
	, "RB170"
	, "RB170_F"
	, "RB180"
	, "RB180_F"
	, "RB190"
	, "RB190_F"
	, "RB200"
	, "RB200_F"
	, "RB210"
	, "RB210_F"
	, "RB220"
	, "RB220_F"
	, "RB230"
	, "RB230_F"
	, "RB240"
	, "RB240_F" 
from stgecv.ecv_raw_persona_2015_basico
where "index" in (select "idx_keep" from t1_2015)
)
union all
(
select 
	"index"
	, '2016' as PK_CICLO
	, "RB010"
	, "RB020"
	, "RB030"
	, "RB040"
	, "RB060"
	, "RB060_F"
	, "RB062"
	, "RB062_F"
	, "RB063"
	, "RB063_F"
	, "RB064"
	, "RB064_F"
	, "RB100"
	, "RB100_F"
	, "RB070"
	, "RB070_F"
	, "RB080"
	, "RB080_F"
	, "RB090"
	, "RB090_F"
	, "RB110"
	, "RB110_F"
	, "RB120"
	, "RB120_F"
	, "RB140"
	, "RB140_F"
	, "RB150"
	, "RB150_F"
	, "RB160"
	, "RB160_F"
	, "RB170"
	, "RB170_F"
	, "RB180"
	, "RB180_F"
	, "RB190"
	, "RB190_F"
	, "RB200"
	, "RB200_F"
	, "RB210"
	, "RB210_F"
	, "RB220"
	, "RB220_F"
	, "RB230"
	, "RB230_F"
	, "RB240"
	, "RB240_F" 
from stgecv.ecv_raw_persona_2016_basico
where "index" in (select "idx_keep" from t1_2016)
)
union all
(
select 
	"index"
	, '2017' as PK_CICLO
	, "RB010"
	, "RB020"
	, "RB030"
	, "RB040"
	, "RB060"
	, "RB060_F"
	, "RB062"
	, "RB062_F"
	, "RB063"
	, "RB063_F"
	, "RB064"
	, "RB064_F"
	, "RB100"
	, "RB100_F"
	, "RB070"
	, "RB070_F"
	, "RB080"
	, "RB080_F"
	, "RB090"
	, "RB090_F"
	, "RB110"
	, "RB110_F"
	, "RB120"
	, "RB120_F"
	, "RB140"
	, "RB140_F"
	, "RB150"
	, "RB150_F"
	, "RB160"
	, "RB160_F"
	, "RB170"
	, "RB170_F"
	, "RB180"
	, "RB180_F"
	, "RB190"
	, "RB190_F"
	, "RB200"
	, "RB200_F"
	, "RB210"
	, "RB210_F"
	, "RB220"
	, "RB220_F"
	, "RB230"
	, "RB230_F"
	, "RB240"
	, "RB240_F" 
from stgecv.ecv_raw_persona_2017_basico
where "index" in (select "idx_keep" from t1_2017)
)
union all
(
select 
	"index"
	, '2018' as PK_CICLO
	, "RB010"
	, "RB020"
	, "RB030"
	, "RB040"
	, "RB060"
	, "RB060_F"
	, "RB062"
	, "RB062_F"
	, "RB063"
	, "RB063_F"
	, "RB064"
	, "RB064_F"
	, "RB100"
	, "RB100_F"
	, "RB070"
	, "RB070_F"
	, "RB080"
	, "RB080_F"
	, "RB090"
	, "RB090_F"
	, "RB110"
	, "RB110_F"
	, "RB120"
	, "RB120_F"
	, "RB140"
	, "RB140_F"
	, "RB150"
	, "RB150_F"
	, "RB160"
	, "RB160_F"
	, "RB170"
	, "RB170_F"
	, "RB180"
	, "RB180_F"
	, "RB190"
	, "RB190_F"
	, "RB200"
	, "RB200_F"
	, "RB210"
	, "RB210_F"
	, "RB220"
	, "RB220_F"
	, "RB230"
	, "RB230_F"
	, "RB240"
	, "RB240_F" 
from stgecv.ecv_raw_persona_2018_basico
where "index" in (select "idx_keep" from t1_2018)
)
union all
(
select 
	"index"
	, '2019' as PK_CICLO
	, "RB010"
	, "RB020"
	, "RB030"
	, "RB040"
	, "RB060"
	, "RB060_F"
	, "RB062"
	, "RB062_F"
	, "RB063"
	, "RB063_F"
	, "RB064"
	, "RB064_F"
	, "RB100"
	, "RB100_F"
	, "RB070"
	, "RB070_F"
	, "RB080"
	, "RB080_F"
	, "RB090"
	, "RB090_F"
	, "RB110"
	, "RB110_F"
	, "RB120"
	, "RB120_F"
	, "RB140"
	, "RB140_F"
	, "RB150"
	, "RB150_F"
	, "RB160"
	, "RB160_F"
	, "RB170"
	, "RB170_F"
	, "RB180"
	, "RB180_F"
	, "RB190"
	, "RB190_F"
	, "RB200"
	, "RB200_F"
	, "RB210"
	, "RB210_F"
	, "RB220"
	, "RB220_F"
	, "RB230"
	, "RB230_F"
	, "RB240"
	, "RB240_F" 
from stgecv.ecv_raw_persona_2019_basico
where "index" in (select "idx_keep" from t1_2019)
)
union all
(
select 
	"index"
	, '2020' as PK_CICLO
	, "RB010"
	, "RB020"
	, "RB030"
	, "RB040"
	, "RB060"
	, "RB060_F"
	, "RB062"
	, "RB062_F"
	, "RB063"
	, "RB063_F"
	, "RB064"
	, "RB064_F"
	, "RB100"
	, "RB100_F"
	, "RB070"
	, "RB070_F"
	, "RB080"
	, "RB080_F"
	, "RB090"
	, "RB090_F"
	, "RB110"
	, "RB110_F"
	, "RB120"
	, "RB120_F"
	, "RB140"
	, "RB140_F"
	, "RB150"
	, "RB150_F"
	, "RB160"
	, "RB160_F"
	, "RB170"
	, "RB170_F"
	, "RB180"
	, "RB180_F"
	, "RB190"
	, "RB190_F"
	, "RB200"
	, "RB200_F"
	, "RB210"
	, "RB210_F"
	, "RB220"
	, "RB220_F"
	, "RB230"
	, "RB230_F"
	, "RB240"
	, "RB240_F" 
from stgecv.ecv_raw_persona_2020_basico
where "index" in (select "idx_keep" from t1_2020)
)
union all
(
select 
	"index"
	, '2021' as PK_CICLO
	, "RB010"
	, "RB020"
	, "RB030"
	, "RB040"
	, "RB060"
	, "RB060_F"
	, "RB062"
	, "RB062_F"
	, "RB063"
	, "RB063_F"
	, "RB064"
	, "RB064_F"
	, "RB100"
	, "RB100_F"
	, '1' as "RB070"
	, null as "RB070_F"
	, "RB080"
	, "RB080_F"
	, "RB090"
	, "RB090_F"
	, "RB110"
	, "RB110_F"
	, "RB120"
	, "RB120_F"
	, null "RB140"
	, null as "RB140_F"
	, null as "RB150"
	, null as "RB150_F"
	, null as "RB160"
	, null as "RB160_F"
	, null as "RB170"
	, null as "RB170_F"
	, null as "RB180"
	, null as "RB180_F"
	, null as "RB190"
	, null as "RB190_F"
	, "RB200"
	, "RB200_F"
	, "RB210"
	, "RB210_F"
	, "RB220"
	, "RB220_F"
	, "RB230"
	, "RB230_F"
	, "RB240"
	, "RB240_F" 
from stgecv.ecv_raw_persona_2021_basico
where "index" in (select "idx_keep" from t1_2021))
),
taux_hogar as
(
	select 
		concat("DB010", "DB030") as pk_distinct 
	from stgecv.ecv_raw_hogar_basico
)
select 
	"RB010"
	, "RB020"
	, "pk_ciclo" || "RB030" as "RB030"
	, "pk_ciclo" || "RB040" as "RB040"
	, "RB060"
	, "RB060_F"
	, "RB062"
	, "RB062_F"
	, "RB063"
	, "RB063_F"
	, "RB064"
	, "RB064_F"
	, "RB100"
	, "RB100_F"
	, "RB070"
	, "RB070_F"
	, "RB080"
	, "RB080_F"
	, "RB090"
	, "RB090_F"
	, "RB110"
	, "RB110_F"
	, "RB120"
	, "RB120_F"
	, "RB140"
	, "RB140_F"
	, "RB150"
	, "RB150_F"
	, "RB160"
	, "RB160_F"
	, "RB170"
	, "RB170_F"
	, "RB180"
	, "RB180_F"
	, "RB190"
	, "RB190_F"
	, "RB200"
	, "RB200_F"
	, "RB210"
	, "RB210_F"
	, "RB220"
	, "RB220_F"
	, "RB230"
	, "RB230_F"
	, "RB240"
	, "RB240_F" 
from taux_persona
where  "RB010" || "pk_ciclo" || "RB040" in (select * from taux_hogar)
;

--stg persona detalle
create table stgecv.ecv_raw_persona as
with
taux_persona_detalle as (
select
	"index"
	, '2011' as PK_CICLO
	, "PB010"
	, "PB020"
	, "PB030"
	, "PB050"
	, "PB050_F"
	, "PB100"
	, "PB100_F"
	, "PB110"
	, "PB110_F"
	, "PB120"
	, "PB120_F"
	, "PB130"
	, "PB130_F"
	, "PB140"
	, "PB140_F"
	, "PB150"
	, "PB150_F"
	, "PB160"
	, "PB160_F"
	, "PB170"
	, "PB170_F"
	, "PB180"
	, "PB180_F"
	, "PB190"
	, "PB190_F"
	, "PB200"
	, "PB200_F"
	, "PE040"
	, "PE040_F"
	, null as "PL030"
	, null as "PL030_F"
	, "PL031"
	, "PL031_F"
	, "PL020"
	, "PL020_F"
	, "PL025"
	, "PL025_F"
	, "PL040"
	, "PL040_F"
	, null as "PL050"
	, null as "PL050_F"
	, "PL060"
	, "PL060_F"
	, "PL140"
	, "PL140_F"
	, "PL160"
	, "PL160_F"
	, "PL170"
	, "PL170_F"
	, "PL180"
	, "PL180_F"
	, "PL190"
	, "PL190_F"
	, "PL200"
	, "PL200_F"
	, null as "PL210A"
	, null as "PL210A_F"
	, null as "PL210B"
	, null as "PL210B_F"
	, null as "PL210C"
	, null as "PL210C_F"
	, null as "PL210D"
	, null as "PL210D_F"
	, null as "PL210E"
	, null as "PL210E_F"
	, null as "PL210F"
	, null as "PL210F_F"
	, null as "PL210G"
	, null as "PL210G_F"
	, null as "PL210H"
	, null as "PL210H_F"
	, null as "PL210I"
	, null as "PL210I_F"
	, null as "PL210J"
	, null as "PL210J_F"
	, null as "PL210K"
	, null as "PL210K_F"
	, null as "PL210L"
	, null as "PL210L_F"
	, "PL211A"
	, "PL211A_F"
	, "PL211B"
	, "PL211B_F"
	, "PL211C"
	, "PL211C_F"
	, "PL211D"
	, "PL211D_F"
	, "PL211E"
	, "PL211E_F"
	, "PL211F"
	, "PL211F_F"
	, "PL211G"
	, "PL211G_F"
	, "PL211H"
	, "PL211H_F"
	, "PL211I"
	, null as "PL211I_F"
	, "PL211J"
	, "PL211J_F"
	, "PL211K"
	, "PL211K_F"
	, "PL211L"
	, "PL211L_F"
	, "PH010"
	, "PH010_F"
	, "PH020"
	, "PH020_F"
	, "PH030"
	, "PH030_F"
	, "PY010N"
	, "PY010N_F"
	, "PY020N"
	, "PY020N_F"
	, "PY021N"
	, "PY021N_F"
	, "PY035N"
	, "PY035N_F"
	, "PY050N"
	, "PY050N_F"
	, "PY080N"
	, "PY080N_F"
	, "PY090N"
	, "PY090N_F"
	, "PY100N"
	, "PY100N_F"
	, "PY110N"
	, "PY110N_F"
	, "PY120N"
	, "PY120N_F"
	, "PY130N"
	, "PY130N_F"
	, "PY140N"
	, "PY140N_F"
	, "PY010G"
	, "PY010G_F"
	, "PY020G"
	, "PY020G_F"
	, "PY021G"
	, "PY021G_F"
	, "PY030G"
	, "PY030G_F"
	, "PY035G"
	, "PY035G_F"
	, "PY050G"
	, "PY050G_F"
	, "PY080G"
	, "PY080G_F"
	, "PY090G"
	, "PY090G_F"
	, "PY100G"
	, "PY100G_F"
	, "PY110G"
	, "PY110G_F"
	, "PY120G"
	, "PY120G_F"
	, "PY130G"
	, "PY130G_F"
	, "PY140G"
	, "PY140G_F" 
from stgecv.ecv_raw_persona_2011_detalle
union all
select
	"index"
	, '2012' as PK_CICLO
	, "PB010"
	, "PB020"
	, "PB030"
	, "PB050"
	, "PB050_F"
	, "PB100"
	, "PB100_F"
	, "PB110"
	, "PB110_F"
	, "PB120"
	, "PB120_F"
	, "PB130"
	, "PB130_F"
	, "PB140"
	, "PB140_F"
	, "PB150"
	, "PB150_F"
	, "PB160"
	, "PB160_F"
	, "PB170"
	, "PB170_F"
	, "PB180"
	, "PB180_F"
	, "PB190"
	, "PB190_F"
	, "PB200"
	, "PB200_F"
	, "PE040"
	, "PE040_F"
	, null as "PL030"
	, null as "PL030_F"
	, "PL031"
	, "PL031_F"
	, "PL020"
	, "PL020_F"
	, "PL025"
	, "PL025_F"
	, "PL040"
	, "PL040_F"
	, null as "PL050"
	, null as "PL050_F"
	, "PL060"
	, "PL060_F"
	, "PL140"
	, "PL140_F"
	, "PL160"
	, "PL160_F"
	, "PL170"
	, "PL170_F"
	, "PL180"
	, "PL180_F"
	, "PL190"
	, "PL190_F"
	, "PL200"
	, "PL200_F"
	, null as "PL210A"
	, null as "PL210A_F"
	, null as "PL210B"
	, null as "PL210B_F"
	, null as "PL210C"
	, null as "PL210C_F"
	, null as "PL210D"
	, null as "PL210D_F"
	, null as "PL210E"
	, null as "PL210E_F"
	, null as "PL210F"
	, null as "PL210F_F"
	, null as "PL210G"
	, null as "PL210G_F"
	, null as "PL210H"
	, null as "PL210H_F"
	, null as "PL210I"
	, null as "PL210I_F"
	, null as "PL210J"
	, null as "PL210J_F"
	, null as "PL210K"
	, null as "PL210K_F"
	, null as "PL210L"
	, null as "PL210L_F"
	, "PL211A"
	, "PL211A_F"
	, "PL211B"
	, "PL211B_F"
	, "PL211C"
	, "PL211C_F"
	, "PL211D"
	, "PL211D_F"
	, "PL211E"
	, "PL211E_F"
	, "PL211F"
	, "PL211F_F"
	, "PL211G"
	, "PL211G_F"
	, "PL211H"
	, "PL211H_F"
	, "PL211I"
	, "PL211I_F"
	, "PL211J"
	, "PL211J_F"
	, "PL211K"
	, "PL211K_F"
	, "PL211L"
	, "PL211L_F"
	, "PH010"
	, "PH010_F"
	, "PH020"
	, "PH020_F"
	, "PH030"
	, "PH030_F"
	, "PY010N"
	, "PY010N_F"
	, "PY020N"
	, "PY020N_F"
	, "PY021N"
	, "PY021N_F"
	, "PY035N"
	, "PY035N_F"
	, "PY050N"
	, "PY050N_F"
	, "PY080N"
	, "PY080N_F"
	, "PY090N"
	, "PY090N_F"
	, "PY100N"
	, "PY100N_F"
	, "PY110N"
	, "PY110N_F"
	, "PY120N"
	, "PY120N_F"
	, "PY130N"
	, "PY130N_F"
	, "PY140N"
	, "PY140N_F"
	, "PY010G"
	, "PY010G_F"
	, "PY020G"
	, "PY020G_F"
	, "PY021G"
	, "PY021G_F"
	, "PY030G"
	, "PY030G_F"
	, "PY035G"
	, "PY035G_F"
	, "PY050G"
	, "PY050G_F"
	, "PY080G"
	, "PY080G_F"
	, "PY090G"
	, "PY090G_F"
	, "PY100G"
	, "PY100G_F"
	, "PY110G"
	, "PY110G_F"
	, "PY120G"
	, "PY120G_F"
	, "PY130G"
	, "PY130G_F"
	, "PY140G"
	, "PY140G_F" 
from stgecv.ecv_raw_persona_2012_detalle
union all
select
	"index"
	, '2013' as PK_CICLO
	, "PB010"
	, "PB020"
	, "PB030"
	, "PB050"
	, "PB050_F"
	, "PB100"
	, "PB100_F"
	, "PB110"
	, "PB110_F"
	, "PB120"
	, "PB120_F"
	, "PB130"
	, "PB130_F"
	, "PB140"
	, "PB140_F"
	, "PB150"
	, "PB150_F"
	, "PB160"
	, "PB160_F"
	, "PB170"
	, "PB170_F"
	, "PB180"
	, "PB180_F"
	, "PB190"
	, "PB190_F"
	, "PB200"
	, "PB200_F"
	, "PE040"
	, "PE040_F"
	, null as "PL030"
	, null as "PL030_F"
	, "PL031"
	, "PL031_F"
	, "PL020"
	, "PL020_F"
	, "PL025"
	, "PL025_F"
	, "PL040"
	, "PL040_F"
	, null as "PL050"
	, null as "PL050_F"
	, "PL060"
	, "PL060_F"
	, "PL140"
	, "PL140_F"
	, "PL160"
	, "PL160_F"
	, "PL170"
	, "PL170_F"
	, "PL180"
	, "PL180_F"
	, "PL190"
	, "PL190_F"
	, "PL200"
	, "PL200_F"
	, null as "PL210A"
	, null as "PL210A_F"
	, null as "PL210B"
	, null as "PL210B_F"
	, null as "PL210C"
	, null as "PL210C_F"
	, null as "PL210D"
	, null as "PL210D_F"
	, null as "PL210E"
	, null as "PL210E_F"
	, null as "PL210F"
	, null as "PL210F_F"
	, null as "PL210G"
	, null as "PL210G_F"
	, null as "PL210H"
	, null as "PL210H_F"
	, null as "PL210I"
	, null as "PL210I_F"
	, null as "PL210J"
	, null as "PL210J_F"
	, null as "PL210K"
	, null as "PL210K_F"
	, null as "PL210L"
	, null as "PL210L_F"
	, "PL211A"
	, "PL211A_F"
	, "PL211B"
	, "PL211B_F"
	, "PL211C"
	, "PL211C_F"
	, "PL211D"
	, "PL211D_F"
	, "PL211E"
	, "PL211E_F"
	, "PL211F"
	, "PL211F_F"
	, "PL211G"
	, "PL211G_F"
	, "PL211H"
	, "PL211H_F"
	, "PL211I"
	, "PL211I_F"
	, "PL211J"
	, "PL211J_F"
	, "PL211K"
	, "PL211K_F"
	, "PL211L"
	, "PL211L_F"
	, "PH010"
	, "PH010_F"
	, "PH020"
	, "PH020_F"
	, "PH030"
	, "PH030_F"
	, "PY010N"
	, "PY010N_F"
	, "PY020N"
	, "PY020N_F"
	, "PY021N"
	, "PY021N_F"
	, "PY035N"
	, "PY035N_F"
	, "PY050N"
	, "PY050N_F"
	, "PY080N"
	, "PY080N_F"
	, "PY090N"
	, "PY090N_F"
	, "PY100N"
	, "PY100N_F"
	, "PY110N"
	, "PY110N_F"
	, "PY120N"
	, "PY120N_F"
	, "PY130N"
	, "PY130N_F"
	, "PY140N"
	, "PY140N_F"
	, "PY010G"
	, "PY010G_F"
	, "PY020G"
	, "PY020G_F"
	, "PY021G"
	, "PY021G_F"
	, "PY030G"
	, "PY030G_F"
	, "PY035G"
	, "PY035G_F"
	, "PY050G"
	, "PY050G_F"
	, "PY080G"
	, "PY080G_F"
	, "PY090G"
	, "PY090G_F"
	, "PY100G"
	, "PY100G_F"
	, "PY110G"
	, "PY110G_F"
	, "PY120G"
	, "PY120G_F"
	, "PY130G"
	, "PY130G_F"
	, "PY140G"
	, "PY140G_F" 
from stgecv.ecv_raw_persona_2013_detalle
union all
select
	"index"
	, '2014' as PK_CICLO
	, "PB010"
	, "PB020"
	, "PB030"
	, "PB050"
	, "PB050_F"
	, "PB100"
	, "PB100_F"
	, "PB110"
	, "PB110_F"
	, "PB120"
	, "PB120_F"
	, "PB130"
	, "PB130_F"
	, "PB140"
	, "PB140_F"
	, "PB150"
	, "PB150_F"
	, "PB160"
	, "PB160_F"
	, "PB170"
	, "PB170_F"
	, "PB180"
	, "PB180_F"
	, "PB190"
	, "PB190_F"
	, "PB200"
	, "PB200_F"
	, "PE040"
	, "PE040_F"
	, null as "PL030"
	, null as "PL030_F"
	, "PL031"
	, "PL031_F"
	, "PL020"
	, "PL020_F"
	, "PL025"
	, "PL025_F"
	, "PL040"
	, "PL040_F"
	, null as "PL050"
	, null as "PL050_F"
	, "PL060"
	, "PL060_F"
	, "PL140"
	, "PL140_F"
	, "PL160"
	, "PL160_F"
	, "PL170"
	, "PL170_F"
	, "PL180"
	, "PL180_F"
	, "PL190"
	, "PL190_F"
	, "PL200"
	, "PL200_F"
	, null as "PL210A"
	, null as "PL210A_F"
	, null as "PL210B"
	, null as "PL210B_F"
	, null as "PL210C"
	, null as "PL210C_F"
	, null as "PL210D"
	, null as "PL210D_F"
	, null as "PL210E"
	, null as "PL210E_F"
	, null as "PL210F"
	, null as "PL210F_F"
	, null as "PL210G"
	, null as "PL210G_F"
	, null as "PL210H"
	, null as "PL210H_F"
	, null as "PL210I"
	, null as "PL210I_F"
	, null as "PL210J"
	, null as "PL210J_F"
	, null as "PL210K"
	, null as "PL210K_F"
	, null as "PL210L"
	, null as "PL210L_F"
	, "PL211A"
	, "PL211A_F"
	, "PL211B"
	, "PL211B_F"
	, "PL211C"
	, "PL211C_F"
	, "PL211D"
	, "PL211D_F"
	, "PL211E"
	, "PL211E_F"
	, "PL211F"
	, "PL211F_F"
	, "PL211G"
	, "PL211G_F"
	, "PL211H"
	, "PL211H_F"
	, "PL211I"
	, "PL211I_F"
	, "PL211J"
	, "PL211J_F"
	, "PL211K"
	, "PL211K_F"
	, "PL211L"
	, "PL211L_F"
	, "PH010"
	, "PH010_F"
	, "PH020"
	, "PH020_F"
	, "PH030"
	, "PH030_F"
	, "PY010N"
	, "PY010N_F"
	, "PY020N"
	, "PY020N_F"
	, "PY021N"
	, "PY021N_F"
	, "PY035N"
	, "PY035N_F"
	, "PY050N"
	, "PY050N_F"
	, "PY080N"
	, "PY080N_F"
	, "PY090N"
	, "PY090N_F"
	, "PY100N"
	, "PY100N_F"
	, "PY110N"
	, "PY110N_F"
	, "PY120N"
	, "PY120N_F"
	, "PY130N"
	, "PY130N_F"
	, "PY140N"
	, "PY140N_F"
	, "PY010G"
	, "PY010G_F"
	, "PY020G"
	, "PY020G_F"
	, "PY021G"
	, "PY021G_F"
	, "PY030G"
	, "PY030G_F"
	, "PY035G"
	, "PY035G_F"
	, "PY050G"
	, "PY050G_F"
	, "PY080G"
	, "PY080G_F"
	, "PY090G"
	, "PY090G_F"
	, "PY100G"
	, "PY100G_F"
	, "PY110G"
	, "PY110G_F"
	, "PY120G"
	, "PY120G_F"
	, "PY130G"
	, "PY130G_F"
	, "PY140G"
	, "PY140G_F" 
from stgecv.ecv_raw_persona_2014_detalle
union all
select
	"index"
	, '2015' as PK_CICLO
	, "PB010"
	, "PB020"
	, "PB030"
	, "PB050"
	, "PB050_F"
	, "PB100"
	, "PB100_F"
	, "PB110"
	, "PB110_F"
	, "PB120"
	, "PB120_F"
	, "PB130"
	, "PB130_F"
	, "PB140"
	, "PB140_F"
	, "PB150"
	, "PB150_F"
	, "PB160"
	, "PB160_F"
	, "PB170"
	, "PB170_F"
	, "PB180"
	, "PB180_F"
	, "PB190"
	, "PB190_F"
	, "PB200"
	, "PB200_F"
	, "PE040"
	, "PE040_F"
	, null as "PL030"
	, null as "PL030_F"
	, "PL031"
	, "PL031_F"
	, "PL020"
	, "PL020_F"
	, "PL025"
	, "PL025_F"
	, "PL040"
	, "PL040_F"
	, null as "PL050"
	, null as "PL050_F"
	, "PL060"
	, "PL060_F"
	, "PL140"
	, "PL140_F"
	, "PL160"
	, "PL160_F"
	, "PL170"
	, "PL170_F"
	, "PL180"
	, "PL180_F"
	, "PL190"
	, "PL190_F"
	, "PL200"
	, "PL200_F"
	, null as "PL210A"
	, null as "PL210A_F"
	, null as "PL210B"
	, null as "PL210B_F"
	, null as "PL210C"
	, null as "PL210C_F"
	, null as "PL210D"
	, null as "PL210D_F"
	, null as "PL210E"
	, null as "PL210E_F"
	, null as "PL210F"
	, null as "PL210F_F"
	, null as "PL210G"
	, null as "PL210G_F"
	, null as "PL210H"
	, null as "PL210H_F"
	, null as "PL210I"
	, null as "PL210I_F"
	, null as "PL210J"
	, null as "PL210J_F"
	, null as "PL210K"
	, null as "PL210K_F"
	, null as "PL210L"
	, null as "PL210L_F"
	, "PL211A"
	, "PL211A_F"
	, "PL211B"
	, "PL211B_F"
	, "PL211C"
	, "PL211C_F"
	, "PL211D"
	, "PL211D_F"
	, "PL211E"
	, "PL211E_F"
	, "PL211F"
	, "PL211F_F"
	, "PL211G"
	, "PL211G_F"
	, "PL211H"
	, "PL211H_F"
	, "PL211I"
	, "PL211I_F"
	, "PL211J"
	, "PL211J_F"
	, "PL211K"
	, "PL211K_F"
	, "PL211L"
	, "PL211L_F"
	, "PH010"
	, "PH010_F"
	, "PH020"
	, "PH020_F"
	, "PH030"
	, "PH030_F"
	, "PY010N"
	, "PY010N_F"
	, "PY020N"
	, "PY020N_F"
	, "PY021N"
	, "PY021N_F"
	, "PY035N"
	, "PY035N_F"
	, "PY050N"
	, "PY050N_F"
	, "PY080N"
	, "PY080N_F"
	, "PY090N"
	, "PY090N_F"
	, "PY100N"
	, "PY100N_F"
	, "PY110N"
	, "PY110N_F"
	, "PY120N"
	, "PY120N_F"
	, "PY130N"
	, "PY130N_F"
	, "PY140N"
	, "PY140N_F"
	, "PY010G"
	, "PY010G_F"
	, "PY020G"
	, "PY020G_F"
	, "PY021G"
	, "PY021G_F"
	, "PY030G"
	, "PY030G_F"
	, "PY035G"
	, "PY035G_F"
	, "PY050G"
	, "PY050G_F"
	, "PY080G"
	, "PY080G_F"
	, "PY090G"
	, "PY090G_F"
	, "PY100G"
	, "PY100G_F"
	, "PY110G"
	, "PY110G_F"
	, "PY120G"
	, "PY120G_F"
	, "PY130G"
	, "PY130G_F"
	, "PY140G"
	, "PY140G_F" 
from stgecv.ecv_raw_persona_2015_detalle
union all
select
	"index"
	, '2016' as PK_CICLO
	, "PB010"
	, "PB020"
	, "PB030"
	, "PB050"
	, "PB050_F"
	, "PB100"
	, "PB100_F"
	, "PB110"
	, "PB110_F"
	, "PB120"
	, "PB120_F"
	, "PB130"
	, "PB130_F"
	, "PB140"
	, "PB140_F"
	, "PB150"
	, "PB150_F"
	, "PB160"
	, "PB160_F"
	, "PB170"
	, "PB170_F"
	, "PB180"
	, "PB180_F"
	, "PB190"
	, "PB190_F"
	, "PB200"
	, "PB200_F"
	, "PE040"
	, "PE040_F"
	, null as "PL030"
	, null as "PL030_F"
	, "PL031"
	, "PL031_F"
	, "PL020"
	, "PL020_F"
	, "PL025"
	, "PL025_F"
	, "PL040"
	, "PL040_F"
	, null as "PL050"
	, null as "PL050_F"
	, "PL060"
	, "PL060_F"
	, "PL140"
	, "PL140_F"
	, "PL160"
	, "PL160_F"
	, "PL170"
	, "PL170_F"
	, "PL180"
	, "PL180_F"
	, "PL190"
	, "PL190_F"
	, "PL200"
	, "PL200_F"
	, null as "PL210A"
	, null as "PL210A_F"
	, null as "PL210B"
	, null as "PL210B_F"
	, null as "PL210C"
	, null as "PL210C_F"
	, null as "PL210D"
	, null as "PL210D_F"
	, null as "PL210E"
	, null as "PL210E_F"
	, null as "PL210F"
	, null as "PL210F_F"
	, null as "PL210G"
	, null as "PL210G_F"
	, null as "PL210H"
	, null as "PL210H_F"
	, null as "PL210I"
	, null as "PL210I_F"
	, null as "PL210J"
	, null as "PL210J_F"
	, null as "PL210K"
	, null as "PL210K_F"
	, null as "PL210L"
	, null as "PL210L_F"
	, "PL211A"
	, "PL211A_F"
	, "PL211B"
	, "PL211B_F"
	, "PL211C"
	, "PL211C_F"
	, "PL211D"
	, "PL211D_F"
	, "PL211E"
	, "PL211E_F"
	, "PL211F"
	, "PL211F_F"
	, "PL211G"
	, "PL211G_F"
	, "PL211H"
	, "PL211H_F"
	, "PL211I"
	, "PL211I_F"
	, "PL211J"
	, "PL211J_F"
	, "PL211K"
	, "PL211K_F"
	, "PL211L"
	, "PL211L_F"
	, "PH010"
	, "PH010_F"
	, "PH020"
	, "PH020_F"
	, "PH030"
	, "PH030_F"
	, "PY010N"
	, "PY010N_F"
	, "PY020N"
	, "PY020N_F"
	, "PY021N"
	, "PY021N_F"
	, "PY035N"
	, "PY035N_F"
	, "PY050N"
	, "PY050N_F"
	, "PY080N"
	, "PY080N_F"
	, "PY090N"
	, "PY090N_F"
	, "PY100N"
	, "PY100N_F"
	, "PY110N"
	, "PY110N_F"
	, "PY120N"
	, "PY120N_F"
	, "PY130N"
	, "PY130N_F"
	, "PY140N"
	, "PY140N_F"
	, "PY010G"
	, "PY010G_F"
	, "PY020G"
	, "PY020G_F"
	, "PY021G"
	, "PY021G_F"
	, "PY030G"
	, "PY030G_F"
	, "PY035G"
	, "PY035G_F"
	, "PY050G"
	, "PY050G_F"
	, "PY080G"
	, "PY080G_F"
	, "PY090G"
	, "PY090G_F"
	, "PY100G"
	, "PY100G_F"
	, "PY110G"
	, "PY110G_F"
	, "PY120G"
	, "PY120G_F"
	, "PY130G"
	, "PY130G_F"
	, "PY140G"
	, "PY140G_F" 
from stgecv.ecv_raw_persona_2016_detalle
union all
select
	"index"
	, '2017' as PK_CICLO
	, "PB010"
	, "PB020"
	, "PB030"
	, "PB050"
	, "PB050_F"
	, "PB100"
	, "PB100_F"
	, "PB110"
	, "PB110_F"
	, "PB120"
	, "PB120_F"
	, "PB130"
	, "PB130_F"
	, "PB140"
	, "PB140_F"
	, "PB150"
	, "PB150_F"
	, "PB160"
	, "PB160_F"
	, "PB170"
	, "PB170_F"
	, "PB180"
	, "PB180_F"
	, "PB190"
	, "PB190_F"
	, "PB200"
	, "PB200_F"
	, "PE040"
	, "PE040_F"
	, null as "PL030"
	, null as "PL030_F"
	, "PL031"
	, "PL031_F"
	, "PL020"
	, "PL020_F"
	, "PL025"
	, "PL025_F"
	, "PL040"
	, "PL040_F"
	, null as "PL050"
	, null as "PL050_F"
	, "PL060"
	, "PL060_F"
	, "PL140"
	, "PL140_F"
	, "PL160"
	, "PL160_F"
	, "PL170"
	, "PL170_F"
	, "PL180"
	, "PL180_F"
	, "PL190"
	, "PL190_F"
	, "PL200"
	, "PL200_F"
	, null as "PL210A"
	, null as "PL210A_F"
	, null as "PL210B"
	, null as "PL210B_F"
	, null as "PL210C"
	, null as "PL210C_F"
	, null as "PL210D"
	, null as "PL210D_F"
	, null as "PL210E"
	, null as "PL210E_F"
	, null as "PL210F"
	, null as "PL210F_F"
	, null as "PL210G"
	, null as "PL210G_F"
	, null as "PL210H"
	, null as "PL210H_F"
	, null as "PL210I"
	, null as "PL210I_F"
	, null as "PL210J"
	, null as "PL210J_F"
	, null as "PL210K"
	, null as "PL210K_F"
	, null as "PL210L"
	, null as "PL210L_F"
	, "PL211A"
	, "PL211A_F"
	, "PL211B"
	, "PL211B_F"
	, "PL211C"
	, "PL211C_F"
	, "PL211D"
	, "PL211D_F"
	, "PL211E"
	, "PL211E_F"
	, "PL211F"
	, "PL211F_F"
	, "PL211G"
	, "PL211G_F"
	, "PL211H"
	, "PL211H_F"
	, "PL211I"
	, "PL211I_F"
	, "PL211J"
	, "PL211J_F"
	, "PL211K"
	, "PL211K_F"
	, "PL211L"
	, "PL211L_F"
	, "PH010"
	, "PH010_F"
	, "PH020"
	, "PH020_F"
	, "PH030"
	, "PH030_F"
	, "PY010N"
	, "PY010N_F"
	, "PY020N"
	, "PY020N_F"
	, "PY021N"
	, "PY021N_F"
	, "PY035N"
	, "PY035N_F"
	, "PY050N"
	, "PY050N_F"
	, "PY080N"
	, "PY080N_F"
	, "PY090N"
	, "PY090N_F"
	, "PY100N"
	, "PY100N_F"
	, "PY110N"
	, "PY110N_F"
	, "PY120N"
	, "PY120N_F"
	, "PY130N"
	, "PY130N_F"
	, "PY140N"
	, "PY140N_F"
	, "PY010G"
	, "PY010G_F"
	, "PY020G"
	, "PY020G_F"
	, "PY021G"
	, "PY021G_F"
	, "PY030G"
	, "PY030G_F"
	, "PY035G"
	, "PY035G_F"
	, "PY050G"
	, "PY050G_F"
	, "PY080G"
	, "PY080G_F"
	, "PY090G"
	, "PY090G_F"
	, "PY100G"
	, "PY100G_F"
	, "PY110G"
	, "PY110G_F"
	, "PY120G"
	, "PY120G_F"
	, "PY130G"
	, "PY130G_F"
	, "PY140G"
	, "PY140G_F" 
from stgecv.ecv_raw_persona_2017_detalle
union all
select
	"index"
	, '2018' as PK_CICLO
	, "PB010"
	, "PB020"
	, "PB030"
	, "PB050"
	, "PB050_F"
	, "PB100"
	, "PB100_F"
	, "PB110"
	, "PB110_F"
	, "PB120"
	, "PB120_F"
	, "PB130"
	, "PB130_F"
	, "PB140"
	, "PB140_F"
	, "PB150"
	, "PB150_F"
	, "PB160"
	, "PB160_F"
	, "PB170"
	, "PB170_F"
	, "PB180"
	, "PB180_F"
	, "PB190"
	, "PB190_F"
	, "PB200"
	, "PB200_F"
	, "PE040"
	, "PE040_F"
	, null as "PL030"
	, null as "PL030_F"
	, "PL031"
	, "PL031_F"
	, "PL020"
	, "PL020_F"
	, "PL025"
	, "PL025_F"
	, "PL040"
	, "PL040_F"
	, null as "PL050"
	, null as "PL050_F"
	, "PL060"
	, "PL060_F"
	, "PL140"
	, "PL140_F"
	, "PL160"
	, "PL160_F"
	, "PL170"
	, "PL170_F"
	, "PL180"
	, "PL180_F"
	, "PL190"
	, "PL190_F"
	, "PL200"
	, "PL200_F"
	, null as "PL210A"
	, null as "PL210A_F"
	, null as "PL210B"
	, null as "PL210B_F"
	, null as "PL210C"
	, null as "PL210C_F"
	, null as "PL210D"
	, null as "PL210D_F"
	, null as "PL210E"
	, null as "PL210E_F"
	, null as "PL210F"
	, null as "PL210F_F"
	, null as "PL210G"
	, null as "PL210G_F"
	, null as "PL210H"
	, null as "PL210H_F"
	, null as "PL210I"
	, null as "PL210I_F"
	, null as "PL210J"
	, null as "PL210J_F"
	, null as "PL210K"
	, null as "PL210K_F"
	, null as "PL210L"
	, null as "PL210L_F"
	, "PL211A"
	, "PL211A_F"
	, "PL211B"
	, "PL211B_F"
	, "PL211C"
	, "PL211C_F"
	, "PL211D"
	, "PL211D_F"
	, "PL211E"
	, "PL211E_F"
	, "PL211F"
	, "PL211F_F"
	, "PL211G"
	, "PL211G_F"
	, "PL211H"
	, "PL211H_F"
	, "PL211I"
	, "PL211I_F"
	, "PL211J"
	, "PL211J_F"
	, "PL211K"
	, "PL211K_F"
	, "PL211L"
	, "PL211L_F"
	, "PH010"
	, "PH010_F"
	, "PH020"
	, "PH020_F"
	, "PH030"
	, "PH030_F"
	, "PY010N"
	, "PY010N_F"
	, "PY020N"
	, "PY020N_F"
	, "PY021N"
	, "PY021N_F"
	, "PY035N"
	, "PY035N_F"
	, "PY050N"
	, "PY050N_F"
	, "PY080N"
	, "PY080N_F"
	, "PY090N"
	, "PY090N_F"
	, "PY100N"
	, "PY100N_F"
	, "PY110N"
	, "PY110N_F"
	, "PY120N"
	, "PY120N_F"
	, "PY130N"
	, "PY130N_F"
	, "PY140N"
	, "PY140N_F"
	, "PY010G"
	, "PY010G_F"
	, "PY020G"
	, "PY020G_F"
	, "PY021G"
	, "PY021G_F"
	, "PY030G"
	, "PY030G_F"
	, "PY035G"
	, "PY035G_F"
	, "PY050G"
	, "PY050G_F"
	, "PY080G"
	, "PY080G_F"
	, "PY090G"
	, "PY090G_F"
	, "PY100G"
	, "PY100G_F"
	, "PY110G"
	, "PY110G_F"
	, "PY120G"
	, "PY120G_F"
	, "PY130G"
	, "PY130G_F"
	, "PY140G"
	, "PY140G_F" 
from stgecv.ecv_raw_persona_2018_detalle
union all
select
	"index"
	, '2019' as PK_CICLO
	, "PB010"
	, "PB020"
	, "PB030"
	, "PB050"
	, "PB050_F"
	, "PB100"
	, "PB100_F"
	, "PB110"
	, "PB110_F"
	, "PB120"
	, "PB120_F"
	, "PB130"
	, "PB130_F"
	, "PB140"
	, "PB140_F"
	, "PB150"
	, "PB150_F"
	, "PB160"
	, "PB160_F"
	, "PB170"
	, "PB170_F"
	, "PB180"
	, "PB180_F"
	, "PB190"
	, "PB190_F"
	, "PB200"
	, "PB200_F"
	, "PE040"
	, "PE040_F"
	, null as "PL030"
	, null as "PL030_F"
	, "PL031"
	, "PL031_F"
	, "PL020"
	, "PL020_F"
	, "PL025"
	, "PL025_F"
	, "PL040"
	, "PL040_F"
	, null as "PL050"
	, null as "PL050_F"
	, "PL060"
	, "PL060_F"
	, "PL140"
	, "PL140_F"
	, "PL160"
	, "PL160_F"
	, "PL170"
	, "PL170_F"
	, "PL180"
	, "PL180_F"
	, "PL190"
	, "PL190_F"
	, "PL200"
	, "PL200_F"
	, null as "PL210A"
	, null as "PL210A_F"
	, null as "PL210B"
	, null as "PL210B_F"
	, null as "PL210C"
	, null as "PL210C_F"
	, null as "PL210D"
	, null as "PL210D_F"
	, null as "PL210E"
	, null as "PL210E_F"
	, null as "PL210F"
	, null as "PL210F_F"
	, null as "PL210G"
	, null as "PL210G_F"
	, null as "PL210H"
	, null as "PL210H_F"
	, null as "PL210I"
	, null as "PL210I_F"
	, null as "PL210J"
	, null as "PL210J_F"
	, null as "PL210K"
	, null as "PL210K_F"
	, null as "PL210L"
	, null as "PL210L_F"
	, "PL211A"
	, "PL211A_F"
	, "PL211B"
	, "PL211B_F"
	, "PL211C"
	, "PL211C_F"
	, "PL211D"
	, "PL211D_F"
	, "PL211E"
	, "PL211E_F"
	, "PL211F"
	, "PL211F_F"
	, "PL211G"
	, "PL211G_F"
	, "PL211H"
	, "PL211H_F"
	, "PL211I"
	, "PL211I_F"
	, "PL211J"
	, "PL211J_F"
	, "PL211K"
	, "PL211K_F"
	, "PL211L"
	, "PL211L_F"
	, "PH010"
	, "PH010_F"
	, "PH020"
	, "PH020_F"
	, "PH030"
	, "PH030_F"
	, "PY010N"
	, "PY010N_F"
	, "PY020N"
	, "PY020N_F"
	, "PY021N"
	, "PY021N_F"
	, "PY035N"
	, "PY035N_F"
	, "PY050N"
	, "PY050N_F"
	, "PY080N"
	, "PY080N_F"
	, "PY090N"
	, "PY090N_F"
	, "PY100N"
	, "PY100N_F"
	, "PY110N"
	, "PY110N_F"
	, "PY120N"
	, "PY120N_F"
	, "PY130N"
	, "PY130N_F"
	, "PY140N"
	, "PY140N_F"
	, "PY010G"
	, "PY010G_F"
	, "PY020G"
	, "PY020G_F"
	, "PY021G"
	, "PY021G_F"
	, "PY030G"
	, "PY030G_F"
	, "PY035G"
	, "PY035G_F"
	, "PY050G"
	, "PY050G_F"
	, "PY080G"
	, "PY080G_F"
	, "PY090G"
	, "PY090G_F"
	, "PY100G"
	, "PY100G_F"
	, "PY110G"
	, "PY110G_F"
	, "PY120G"
	, "PY120G_F"
	, "PY130G"
	, "PY130G_F"
	, "PY140G"
	, "PY140G_F" 
from stgecv.ecv_raw_persona_2019_detalle
union all
select
	"index"
	, '2020' as PK_CICLO
	, "PB010"
	, "PB020"
	, "PB030"
	, "PB050"
	, "PB050_F"
	, "PB100"
	, "PB100_F"
	, "PB110"
	, "PB110_F"
	, "PB120"
	, "PB120_F"
	, "PB130"
	, "PB130_F"
	, "PB140"
	, "PB140_F"
	, "PB150"
	, "PB150_F"
	, "PB160"
	, "PB160_F"
	, "PB170"
	, "PB170_F"
	, "PB180"
	, "PB180_F"
	, "PB190"
	, "PB190_F"
	, "PB200"
	, "PB200_F"
	, "PE040"
	, "PE040_F"
	, null as "PL030"
	, null as "PL030_F"
	, "PL031"
	, "PL031_F"
	, "PL020"
	, "PL020_F"
	, "PL025"
	, "PL025_F"
	, "PL040"
	, "PL040_F"
	, null as "PL050"
	, null as "PL050_F"
	, "PL060"
	, "PL060_F"
	, "PL140"
	, "PL140_F"
	, "PL160"
	, "PL160_F"
	, "PL170"
	, "PL170_F"
	, "PL180"
	, "PL180_F"
	, "PL190"
	, "PL190_F"
	, "PL200"
	, "PL200_F"
	, null as "PL210A"
	, null as "PL210A_F"
	, null as "PL210B"
	, null as "PL210B_F"
	, null as "PL210C"
	, null as "PL210C_F"
	, null as "PL210D"
	, null as "PL210D_F"
	, null as "PL210E"
	, null as "PL210E_F"
	, null as "PL210F"
	, null as "PL210F_F"
	, null as "PL210G"
	, null as "PL210G_F"
	, null as "PL210H"
	, null as "PL210H_F"
	, null as "PL210I"
	, null as "PL210I_F"
	, null as "PL210J"
	, null as "PL210J_F"
	, null as "PL210K"
	, null as "PL210K_F"
	, null as "PL210L"
	, null as "PL210L_F"
	, "PL211A"
	, "PL211A_F"
	, "PL211B"
	, "PL211B_F"
	, "PL211C"
	, "PL211C_F"
	, "PL211D"
	, "PL211D_F"
	, "PL211E"
	, "PL211E_F"
	, "PL211F"
	, "PL211F_F"
	, "PL211G"
	, "PL211G_F"
	, "PL211H"
	, "PL211H_F"
	, "PL211I"
	, "PL211I_F"
	, "PL211J"
	, "PL211J_F"
	, "PL211K"
	, "PL211K_F"
	, "PL211L"
	, "PL211L_F"
	, "PH010"
	, "PH010_F"
	, "PH020"
	, "PH020_F"
	, "PH030"
	, "PH030_F"
	, "PY010N"
	, "PY010N_F"
	, "PY020N"
	, "PY020N_F"
	, "PY021N"
	, "PY021N_F"
	, "PY035N"
	, "PY035N_F"
	, "PY050N"
	, "PY050N_F"
	, "PY080N"
	, "PY080N_F"
	, "PY090N"
	, "PY090N_F"
	, "PY100N"
	, "PY100N_F"
	, "PY110N"
	, "PY110N_F"
	, "PY120N"
	, "PY120N_F"
	, "PY130N"
	, "PY130N_F"
	, "PY140N"
	, "PY140N_F"
	, "PY010G"
	, "PY010G_F"
	, "PY020G"
	, "PY020G_F"
	, "PY021G"
	, "PY021G_F"
	, "PY030G"
	, "PY030G_F"
	, "PY035G"
	, "PY035G_F"
	, "PY050G"
	, "PY050G_F"
	, "PY080G"
	, "PY080G_F"
	, "PY090G"
	, "PY090G_F"
	, "PY100G"
	, "PY100G_F"
	, "PY110G"
	, null as "PY110G_F"
	, "PY120G"
	, "PY120G_F"
	, "PY130G"
	, "PY130G_F"
	, "PY140G"
	, "PY140G_F" 
from stgecv.ecv_raw_persona_2020_detalle
union all
select
	"index"
	, '2021' as PK_CICLO
	, "PB010"
	, "PB020"
	, "PB030"
	, "PB050"
	, "PB050_F"
	, "PB100"
	, "PB100_F"
	, "PB110"
	, "PB110_F"
	, "PB120"
	, "PB120_F"
	, '1' as "PB130"
	, null as "PB130_F"
	, "PB140"
	, "PB140_F"
	, "PB150"
	, "PB150_F"
	, "PB160"
	, "PB160_F"
	, "PB170"
	, "PB170_F"
	, "PB180"
	, "PB180_F"
	, "PB190"
	, "PB190_F"
	, "PB200"
	, "PB200_F"
	, "PE040"
	, "PE040_F"
	, null as "PL030"
	, null as "PL030_F"
	, "PL031"
	, "PL031_F"
	, null as "PL020"
	, null as "PL020_F"
	, null as "PL025"
	, null as "PL025_F"
	, "PL040"
	, "PL040_F"
	, null as "PL050"
	, null as "PL050_F"
	, "PL060"
	, "PL060_F"
	, "PL140"
	, "PL140_F"
	, null as "PL160"
	, null as "PL160_F"
	, null as "PL170"
	, null as "PL170_F"
	, null as "PL180"
	, null as "PL180_F"
	, null as "PL190"
	, null as "PL190_F"
	, "PL200"
	, "PL200_F"
	, null as "PL210A"
	, null as "PL210A_F"
	, null as "PL210B"
	, null as "PL210B_F"
	, null as "PL210C"
	, null as "PL210C_F"
	, null as "PL210D"
	, null as "PL210D_F"
	, null as "PL210E"
	, null as "PL210E_F"
	, null as "PL210F"
	, null as "PL210F_F"
	, null as "PL210G"
	, null as "PL210G_F"
	, null as "PL210H"
	, null as "PL210H_F"
	, null as "PL210I"
	, null as "PL210I_F"
	, null as "PL210J"
	, null as "PL210J_F"
	, null as "PL210K"
	, null as "PL210K_F"
	, null as "PL210L"
	, null as "PL210L_F"
	, "PL211A"
	, "PL211A_F"
	, "PL211B"
	, "PL211B_F"
	, "PL211C"
	, "PL211C_F"
	, "PL211D"
	, "PL211D_F"
	, "PL211E"
	, "PL211E_F"
	, "PL211F"
	, "PL211F_F"
	, "PL211G"
	, "PL211G_F"
	, "PL211H"
	, "PL211H_F"
	, "PL211I"
	, "PL211I_F"
	, "PL211J"
	, "PL211J_F"
	, "PL211K"
	, "PL211K_F"
	, "PL211L"
	, "PL211L_F"
	, "PH010"
	, "PH010_F"
	, "PH020"
	, "PH020_F"
	, "PH030"
	, "PH030_F"
	, "PY010N"
	, null as "PY010N_F"
	, "PY020N"
	, null as "PY020N_F"
	, "PY021N"
	, null as "PY021N_F"
	, "PY035N"
	, null as "PY035N_F"
	, "PY050N"
	, null as "PY050N_F"
	, "PY080N"
	, null as "PY080N_F"
	, "PY090N"
	, null as "PY090N_F"
	, "PY100N"
	, null as "PY100N_F"
	, "PY110N"
	, null as "PY110N_F"
	, "PY120N"
	, null as "PY120N_F"
	, "PY130N"
	, null as "PY130N_F"
	, "PY140N"
	, null as "PY140N_F"
	, "PY010G"
	, null as "PY010G_F"
	, "PY020G"
	, null as "PY020G_F"
	, "PY021G"
	, null as "PY021G_F"
	, "PY030G"
	, null as "PY030G_F"
	, "PY035G"
	, null as "PY035G_F"
	, "PY050G"
	, null as "PY050G_F"
	, "PY080G"
	, null as "PY080G_F"
	, "PY090G"
	, null as "PY090G_F"
	, "PY100G"
	, null as "PY100G_F"
	, "PY110G"
	, null as "PY110G_F"
	, "PY120G"
	, null as "PY120G_F"
	, "PY130G"
	, null as "PY130G_F"
	, "PY140G"
	, null as "PY140G_F" 
from stgecv.ecv_raw_persona_2021_detalle
),
taux_persona_distinct as
(
	select 
		concat("RB010", "RB030") as pk_distinct 
	from stgecv.ecv_raw_persona_basico
)
select 
	"PB010"
	, "PB020"
	, pk_ciclo || "PB030" as "PB030"
	, "PB050"
	, "PB050_F"
	, "PB100"
	, "PB100_F"
	, "PB110"
	, "PB110_F"
	, "PB120"
	, "PB120_F"
	, "PB130"
	, "PB130_F"
	, "PB140"
	, "PB140_F"
	, "PB150"
	, "PB150_F"
	, "PB160"
	, "PB160_F"
	, "PB170"
	, "PB170_F"
	, "PB180"
	, "PB180_F"
	, "PB190"
	, "PB190_F"
	, "PB200"
	, "PB200_F"
	, "PE040"
	, "PE040_F"
	, "PL030"
	, "PL030_F"
	, "PL031"
	, "PL031_F"
	, "PL020"
	, "PL020_F"
	, "PL025"
	, "PL025_F"
	, "PL040"
	, "PL040_F"
	, "PL050"
	, "PL050_F"
	, "PL060"
	, "PL060_F"
	, "PL140"
	, "PL140_F"
	, "PL160"
	, "PL160_F"
	, "PL170"
	, "PL170_F"
	, "PL180"
	, "PL180_F"
	, "PL190"
	, "PL190_F"
	, "PL200"
	, "PL200_F"
	, "PL210A"
	, "PL210A_F"
	, "PL210B"
	, "PL210B_F"
	, "PL210C"
	, "PL210C_F"
	, "PL210D"
	, "PL210D_F"
	, "PL210E"
	, "PL210E_F"
	, "PL210F"
	, "PL210F_F"
	, "PL210G"
	, "PL210G_F"
	, "PL210H"
	, "PL210H_F"
	, "PL210I"
	, "PL210I_F"
	, "PL210J"
	, "PL210J_F"
	, "PL210K"
	, "PL210K_F"
	, "PL210L"
	, "PL210L_F"
	, "PL211A"
	, "PL211A_F"
	, "PL211B"
	, "PL211B_F"
	, "PL211C"
	, "PL211C_F"
	, "PL211D"
	, "PL211D_F"
	, "PL211E"
	, "PL211E_F"
	, "PL211F"
	, "PL211F_F"
	, "PL211G"
	, "PL211G_F"
	, "PL211H"
	, "PL211H_F"
	, "PL211I"
	, "PL211I_F"
	, "PL211J"
	, "PL211J_F"
	, "PL211K"
	, "PL211K_F"
	, "PL211L"
	, "PL211L_F"
	, "PH010"
	, "PH010_F"
	, "PH020"
	, "PH020_F"
	, "PH030"
	, "PH030_F"
	, "PY010N"
	, "PY010N_F"
	, "PY020N"
	, "PY020N_F"
	, "PY021N"
	, "PY021N_F"
	, "PY035N"
	, "PY035N_F"
	, "PY050N"
	, "PY050N_F"
	, "PY080N"
	, "PY080N_F"
	, "PY090N"
	, "PY090N_F"
	, "PY100N"
	, "PY100N_F"
	, "PY110N"
	, "PY110N_F"
	, "PY120N"
	, "PY120N_F"
	, "PY130N"
	, "PY130N_F"
	, "PY140N"
	, "PY140N_F"
	, "PY010G"
	, "PY010G_F"
	, "PY020G"
	, "PY020G_F"
	, "PY021G"
	, "PY021G_F"
	, "PY030G"
	, "PY030G_F"
	, "PY035G"
	, "PY035G_F"
	, "PY050G"
	, "PY050G_F"
	, "PY080G"
	, "PY080G_F"
	, "PY090G"
	, "PY090G_F"
	, "PY100G"
	, "PY100G_F"
	, "PY110G"
	, "PY110G_F"
	, "PY120G"
	, "PY120G_F"
	, "PY130G"
	, "PY130G_F"
	, "PY140G"
	, "PY140G_F" 
from taux_persona_detalle
where "PB010" || pk_ciclo || "PB030" in (select * from taux_persona_distinct)
;

--stg: create table flg_riesgo_pobreza
create table stgecv.ecv_taux_flg_riesgo_pobreza as
with t as (
select "RB040" as fk_hogar, 
		"RB010" as pk_anyo, 
		case
			when cast("RB010" as int)-cast("RB080" as int) < '14' then '0.3'
			when cast("RB010" as int)-cast("RB080" as int) >= '14' then '0.5'
		end as val_unidad_consumo
from stgecv.ecv_persona_basico
),
t2 as (
select fk_hogar, 
		pk_anyo, 
		sum(cast(val_unidad_consumo as float))+0.5 as val_unidad_consumo
from t
group by fk_hogar, 
		pk_anyo
),
t3 as (
select h."HB030"
		, h."HB010"
		, h."HY020"
		, t2.val_unidad_consumo
		, cast(h."HY020" as float) / t2.val_unidad_consumo as imp_renta_unidad_consumo
from stgecv.ecv_hogar h
left join t2 
	on 
		cast(h."HB030" as varchar) = t2.fk_hogar
		and cast(h."HB010" as varchar) = t2.pk_anyo
),
t4 as (
select t3."HB010"
		, PERCENTILE_CONT(0.5) WITHIN GROUP(ORDER BY imp_renta_unidad_consumo) as imp_renta_mediana
from t3
group by t3."HB010"
)
select t3."HB030" as pk_hogar
		, t3."HB010" as pk_anyo
		, t3.imp_renta_unidad_consumo
		, case
			when imp_renta_unidad_consumo <= t4.imp_renta_mediana * 0.6 then '1'
			else '0'
		end as flg_riesgo_pobreza
from t3
left join t4
	on
		t3."HB010" = t4."HB010";
	
--stg: create table flg_carencia_material_severa
create table stgecv.ecv_taux_flg_carencia_material_severa as
with t as (
select "HB010" as pk_anyo
		, "HB030" as pk_hogar
		, case
			when "HS040" = '2' then 1
			else 0
		end as flg_vacaciones
		, case
			when "HS050" = '2' then 1
			else 0
		end as flg_comida
		, case
			when "HH050" = '2' then 1
			else 0
		end as flg_temperatura
		, case
			when "HS060" = '2' then 1
			else 0
		end as flg_gastos_imprevistos
		, case
			when ("HS011" IN ('1', '2') or "HS021" in ('1', '2')) then 1
			else 0
		end as flg_retraso_pago
		, case
			when "HS110" = '2' then 1
			else 0
		end as flg_coche
		, case
			when "HS070" = '2' then 1
			else 0
		end as flg_telefono
		, case
			when "HS080" = '2' then 1
			else 0
		end as flg_television
		, case
			when "HS100" = '2' then 1
			else 0
		end as flg_lavadora
from stgecv.ecv_hogar)
select pk_anyo
		, pk_hogar
		, case 
			when flg_vacaciones + flg_comida + flg_temperatura + flg_gastos_imprevistos + flg_retraso_pago + flg_coche + flg_telefono + flg_television + flg_lavadora > 3 then '1'
			else '0'
		end as flg_carencia_material_severa
		, flg_vacaciones 
		, flg_comida 
		, flg_temperatura 
		, flg_gastos_imprevistos 
		, flg_retraso_pago 
		, flg_coche 
		, flg_telefono 
		, flg_television 
		, flg_lavadora 
from t;

--stg: create table flg_hogar_baja_intensidad_empleo
--flg_hogar_baja_intensidad_empleo
create table stgecv.ecv_taux_flg_hogar_baja_intensidad_empleo as
with t as (
select pb."RB040" as fk_hogar
		, pb."RB010" as pk_anyo
		, pb."RB030" as pk_persona
		, case
			when "PL211A" in ('1', '3') then 1
			when "PL211A" in ('2', '4') then 0.5
			else 0
		end as val_actividad_enero
		, case 
			when "PL211A" in ('1', '2', '3', '4', '5') then 1
			else 0
		end as val_potencial_actividad_enero
		, case
			when "PL211B" in ('1', '3') then 1
			when "PL211B" in ('2', '4') then 0.5
			else 0
		end as val_actividad_febrero
		, case 
			when "PL211B" in ('1', '2', '3', '4', '5') then 1
			else 0
		end as val_potencial_actividad_febrero
		, case
			when "PL211C" in ('1', '3') then 1
			when "PL211C" in ('2', '4') then 0.5
			else 0
		end as val_actividad_marzo
		, case 
			when "PL211C" in ('1', '2', '3', '4', '5') then 1
			else 0
		end as val_potencial_actividad_marzo
		, case
			when "PL211D" in ('1', '3') then 1
			when "PL211D" in ('2', '4') then 0.5
			else 0
		end as val_actividad_abril
		, case 
			when "PL211D" in ('1', '2', '3', '4', '5') then 1
			else 0
		end as val_potencial_actividad_abril
		, case
			when "PL211E" in ('1', '3') then 1
			when "PL211E" in ('2', '4') then 0.5
			else 0
		end as val_actividad_mayo
		, case 
			when "PL211E" in ('1', '2', '3', '4', '5') then 1
			else 0
		end as val_potencial_actividad_mayo
		, case
			when "PL211F" in ('1', '3') then 1
			when "PL211F" in ('2', '4') then 0.5
			else 0
		end as val_actividad_junio
		, case 
			when "PL211F" in ('1', '2', '3', '4', '5') then 1
			else 0
		end as val_potencial_actividad_junio
		, case
			when "PL211G" in ('1', '3') then 1
			when "PL211G" in ('2', '4') then 0.5
			else 0
		end as val_actividad_julio
		, case 
			when "PL211G" in ('1', '2', '3', '4', '5') then 1
			else 0
		end as val_potencial_actividad_julio
		, case
			when "PL211H" in ('1', '3') then 1
			when "PL211H" in ('2', '4') then 0.5
			else 0
		end as val_actividad_agosto
		, case 
			when "PL211H" in ('1', '2', '3', '4', '5') then 1
			else 0
		end as val_potencial_actividad_agosto
		, case
			when "PL211I" in ('1', '3') then 1
			when "PL211I" in ('2', '4') then 0.5
			else 0
		end as val_actividad_septiembre
		, case 
			when "PL211I" in ('1', '2', '3', '4', '5') then 1
			else 0
		end as val_potencial_actividad_septiembre
		, case
			when "PL211J" in ('1', '3') then 1
			when "PL211J" in ('2', '4') then 0.5
			else 0
		end as val_actividad_octubre
		, case 
			when "PL211J" in ('1', '2', '3', '4', '5') then 1
			else 0
		end as val_potencial_actividad_octubre
		, case
			when "PL211K" in ('1', '3') then 1
			when "PL211K" in ('2', '4') then 0.5
			else 0
		end as val_actividad_noviembre
		, case 
			when "PL211K" in ('1', '2', '3', '4', '5') then 1
			else 0
		end as val_potencial_actividad_noviembre
		, case
			when "PL211L" in ('1', '3') then 1
			when "PL211L" in ('2', '4') then 0.5
			else 0
		end as val_actividad_diciembre
		, case 
			when "PL211L" in ('1', '2', '3', '4', '5') then 1
			else 0
		end as val_potencial_actividad_diciembre
from stgecv.ecv_persona_basico pb
left join stgecv.ecv_persona p
	on
		pb."RB010" = p."PB010"
		and pb."RB030" = p."PB030"
where case
			when cast(pb."RB010" as int)-cast(pb."RB080" as int) < '59' then '1'
			when cast(pb."RB010" as int)-cast(pb."RB080" as int) >= '60' then '0'
		end = '1'
),
t2 as (
select fk_hogar
		, pk_anyo
		, pk_persona
		, (val_actividad_enero + val_actividad_febrero + val_actividad_marzo + 
			val_actividad_abril + val_actividad_mayo + val_actividad_junio + 
			val_actividad_julio + val_actividad_agosto + val_actividad_septiembre + 
			val_actividad_octubre + val_actividad_noviembre + val_actividad_diciembre) as val_actividad
		, (val_potencial_actividad_enero + val_potencial_actividad_febrero + val_potencial_actividad_marzo + 
			val_potencial_actividad_abril + val_potencial_actividad_mayo + val_potencial_actividad_junio + 
			val_potencial_actividad_julio + val_potencial_actividad_agosto + val_potencial_actividad_septiembre + 
			val_potencial_actividad_octubre + val_potencial_actividad_noviembre + val_potencial_actividad_diciembre) as val_potencial_actividad
from t
),
t3 as (
select fk_hogar
		, pk_anyo
		, pk_persona
		, case 
			when sum(val_potencial_actividad) over(partition by fk_hogar, pk_anyo) = '0' then '0'
			else (sum(val_actividad) over(partition by fk_hogar, pk_anyo) / 
					sum(val_potencial_actividad) over(partition by fk_hogar, pk_anyo))
		end as ratio_actividad_hogar
from t2
)
select fk_hogar
		, pk_anyo
		, pk_persona
		, case
			when pk_anyo = '2008' then '0'
			when ratio_actividad_hogar < 0.2 then '1'
			else '0'
		end as flg_hogar_baja_intensidad_empleo
from t3;


